-- ==================== BASE DE DATOS SISTEMA BOMBEROS ====================
DROP DATABASE IF EXISTS sistema_bomberos;
CREATE DATABASE sistema_bomberos CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE sistema_bomberos;

-- ==================== TABLA: USUARIOS ====================
CREATE TABLE usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL,
    email VARCHAR(100),
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- ==================== TABLA: BOMBEROS ====================
CREATE TABLE bomberos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    clave_bombero VARCHAR(20) NOT NULL UNIQUE,
    nombre VARCHAR(100) NOT NULL,
    rut VARCHAR(12) NOT NULL UNIQUE,
    fecha_nacimiento DATE NOT NULL,
    fecha_ingreso DATE NOT NULL,
    compania VARCHAR(100),
    telefono VARCHAR(20),
    email VARCHAR(100),
    foto LONGTEXT,
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- ==================== TABLA: CARGOS ====================
CREATE TABLE cargos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    bombero_id INT NOT NULL,
    tipo_cargo VARCHAR(100) NOT NULL,
    fecha_inicio DATE NOT NULL,
    fecha_fin DATE,
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (bombero_id) REFERENCES bomberos(id) ON DELETE CASCADE
) ENGINE=InnoDB;

-- ==================== TABLA: SANCIONES ====================
CREATE TABLE sanciones (
    id INT AUTO_INCREMENT PRIMARY KEY,
    bombero_id INT NOT NULL,
    tipo_sancion VARCHAR(50) NOT NULL,
    fecha_sancion DATE NOT NULL,
    descripcion TEXT NOT NULL,
    estado VARCHAR(20) DEFAULT 'Activa',
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (bombero_id) REFERENCES bomberos(id) ON DELETE CASCADE
) ENGINE=InnoDB;

-- ==================== TABLA: BENEFICIOS ====================
CREATE TABLE beneficios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    monto_total DECIMAL(10, 2) NOT NULL,
    fecha_inicio DATE NOT NULL,
    fecha_fin DATE NOT NULL,
    estado VARCHAR(20) DEFAULT 'activo',
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- ==================== TABLA: ASIGNACIONES DE BENEFICIOS ====================
CREATE TABLE asignaciones_beneficios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    beneficio_id INT NOT NULL,
    bombero_id INT NOT NULL,
    monto_esperado DECIMAL(10, 2) NOT NULL,
    monto_pagado DECIMAL(10, 2) DEFAULT 0.00,
    estado_pago VARCHAR(20) DEFAULT 'pendiente',
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (beneficio_id) REFERENCES beneficios(id) ON DELETE CASCADE,
    FOREIGN KEY (bombero_id) REFERENCES bomberos(id) ON DELETE CASCADE
) ENGINE=InnoDB;

-- ==================== TABLA: PAGOS DE CUOTAS ====================
CREATE TABLE pagos_cuotas (
    id INT AUTO_INCREMENT PRIMARY KEY,
    bombero_id INT NOT NULL,
    mes INT NOT NULL,
    anio INT NOT NULL,
    monto DECIMAL(10, 2) NOT NULL,
    fecha_pago DATE NOT NULL,
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (bombero_id) REFERENCES bomberos(id) ON DELETE CASCADE
) ENGINE=InnoDB;

-- ==================== TABLA: MOVIMIENTOS FINANCIEROS ====================
CREATE TABLE movimientos_financieros (
    id INT AUTO_INCREMENT PRIMARY KEY,
    tipo VARCHAR(20) NOT NULL,
    categoria VARCHAR(50) NOT NULL,
    monto DECIMAL(10, 2) NOT NULL,
    descripcion TEXT NOT NULL,
    fecha_movimiento DATE NOT NULL,
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

-- ==================== TABLA: PAGOS DE BENEFICIOS ====================
CREATE TABLE pagos_beneficios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    asignacion_id INT NOT NULL,
    monto_pagado DECIMAL(10, 2) NOT NULL,
    fecha_pago DATE NOT NULL,
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (asignacion_id) REFERENCES asignaciones_beneficios(id) ON DELETE CASCADE
) ENGINE=InnoDB;
