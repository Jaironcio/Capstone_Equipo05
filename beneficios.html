<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto SEIS - Administraci√≥n de Beneficios</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- AGREGAR ESTAS DOS L√çNEAS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="css/beneficios.css">
</head>
<body>
    <div class="page-container beneficios-page">
        <div class="container">
            <div class="page-header beneficios-header">
                <h2>üé™ ADMINISTRACI√ìN DE BENEFICIOS</h2>
                <p>Gesti√≥n de Eventos y Control de Deudores</p>
            </div>

            <div class="page-content">
                <div id="mensajeBeneficios" class="mensaje-global" style="display: none;"></div>

                <!-- Dashboard de Estad√≠sticas Mejorado -->
                <div class="dashboard-stats">
                    <div class="stat-card-modern card-beneficios">
                        <div class="stat-icon">üé´</div>
                        <div class="stat-content">
                            <div class="stat-label">Beneficios Activos</div>
                            <div class="stat-value" id="totalBeneficiosActivos">0</div>
                            <div class="stat-progress">
                                <div class="progress-bar" id="progressBeneficiosActivos"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card-modern card-esperado">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-content">
                            <div class="stat-label">Total Esperado</div>
                            <div class="stat-value" id="totalEsperado">$0</div>
                            <div class="stat-percentage" id="porcentajeEsperado">100%</div>
                        </div>
                    </div>
                    
                    <div class="stat-card-modern card-recaudado">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-content">
                            <div class="stat-label">Total Recaudado</div>
                            <div class="stat-value" id="totalRecaudado">$0</div>
                            <div class="stat-percentage" id="porcentajeRecaudado">0%</div>
                        </div>
                    </div>
                    
                    <div class="stat-card-modern card-deudores">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-content">
                            <div class="stat-label">Deudores</div>
                            <div class="stat-value" id="totalDeudores">0</div>
                            <div class="stat-percentage" id="porcentajeDeudores">0%</div>
                        </div>
                    </div>

                    <div class="stat-card-modern card-eficiencia">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-content">
                            <div class="stat-label">Eficiencia de Cobro</div>
                            <div class="stat-value" id="eficienciaGeneral">0%</div>
                            <div class="stat-trend" id="trendEficiencia"></div>
                        </div>
                    </div>
                </div>

                <!-- Formulario Crear Beneficio (sin cambios) -->
                <div class="form-container">
                    <h3>üé™ Crear Nuevo Beneficio</h3>
                    
                    <form id="formCrearBeneficio">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="tipoBeneficio" class="required">Tipo de Beneficio</label>
                                <select id="tipoBeneficio" name="tipoBeneficio" required>
                                    <option value="">Seleccione tipo</option>
                                    <option value="Curanto">üç≤ Curanto</option>
                                    <option value="Bingo">üé∞ Bingo</option>
                                    <option value="Rifa">üé´ Rifa</option>
                                    <option value="Asado">ü•© Asado</option>
                                    <option value="Otro">üìå Otro</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="nombreBeneficio" class="required">Nombre del Evento</label>
                                <input type="text" id="nombreBeneficio" name="nombreBeneficio" required 
                                       placeholder="Ej: Curanto Mayo 2025">
                            </div>

                            <div class="form-group">
                                <label for="fechaEvento" class="required">Fecha del Evento</label>
                                <input type="date" id="fechaEvento" name="fechaEvento" required>
                            </div>

                            <div class="form-group">
                                <label for="fechaLimiteRendicion" class="required">Fecha L√≠mite Rendici√≥n</label>
                                <input type="date" id="fechaLimiteRendicion" name="fechaLimiteRendicion" required>
                            </div>

                            <div class="form-group">
                                <label for="precioTarjeta" class="required">Precio por Tarjeta (CLP)</label>
                                <input type="number" id="precioTarjeta" name="precioTarjeta" required 
                                       min="100" step="100" placeholder="Ej: 8000">
                            </div>

                            <div class="form-group full-width">
                                <label class="required">Tarjetas por Categor√≠a</label>
                                <div class="categorias-grid">
                                    <div class="categoria-input">
                                        <label>üë§ Voluntarios Regulares</label>
                                        <input type="number" id="tarjetasVoluntarios" name="tarjetasVoluntarios" 
                                               required min="0" value="8" placeholder="Ej: 8">
                                    </div>
                                    
                                    <div class="categoria-input">
                                        <label>üèÖ Honorarios de Compa√±√≠a</label>
                                        <input type="number" id="tarjetasHonorariosCia" name="tarjetasHonorariosCia" 
                                               required min="0" value="5" placeholder="Ej: 5">
                                    </div>
                                    
                                    <div class="categoria-input">
                                        <label>üéñÔ∏è Honorarios del Cuerpo</label>
                                        <input type="number" id="tarjetasHonorariosCuerpo" name="tarjetasHonorariosCuerpo" 
                                               required min="0" value="3" placeholder="Ej: 3">
                                    </div>
                                    
                                    <div class="categoria-input">
                                        <label>üèÜ Insignes de Chile</label>
                                        <input type="number" id="tarjetasInsignes" name="tarjetasInsignes" 
                                               required min="0" value="2" placeholder="Ej: 2">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group full-width">
                                <label for="descripcionBeneficio" class="opcional">Descripci√≥n</label>
                                <textarea id="descripcionBeneficio" name="descripcionBeneficio" rows="3" 
                                          placeholder="Descripci√≥n del beneficio"></textarea>
                            </div>

                            <div class="info-nota">
                                üí° <strong>Nota:</strong> Al crear el beneficio, se asignar√° autom√°ticamente a TODOS los bomberos registrados seg√∫n su categor√≠a de antig√ºedad.
                            </div>
                        </div>

                        <div class="buttons">
                            <button type="submit" class="btn btn-beneficio">üé™ Crear Beneficio y Asignar</button>
                            <button type="button" class="btn btn-secondary" onclick="beneficiosSistema.limpiarFormulario()">Limpiar</button>
                        </div>
                    </form>
                </div>

                <!-- Lista de Beneficios Mejorada -->
                <div class="list-container-modern">
                    <div class="list-header-modern">
                        <h3>üìö Beneficios Registrados</h3>
                        <div class="filtros-beneficios">
                            <select id="filtroAnio" onchange="beneficiosSistema.aplicarFiltros()">
                                <option value="todos">Todos los a√±os</option>
                            </select>
                            <select id="filtroBeneficios" onchange="beneficiosSistema.aplicarFiltros()">
                                <option value="todos">Todos los estados</option>
                                <option value="activo">Activos</option>
                                <option value="cerrado">Cerrados</option>
                                <option value="vencido">Vencidos</option>
                            </select>
                            <button type="button" class="btn btn-excel" onclick="beneficiosSistema.exportarExcel()">
                                üìä Exportar Excel
                            </button>
                        </div>
                    </div>
                    
                    <div class="contador-beneficios">
                        Mostrando <strong id="totalBeneficiosMostrados">0</strong> de <strong id="totalBeneficios">0</strong> beneficios
                    </div>
                    
                    <div id="listaBeneficios" class="lista-beneficios-grid"></div>
                </div>

                <!-- Gr√°fico de Deudores Mejorado -->
                <div class="graficos-container">
                    <div class="grafico-card">
                        <h3>üìä Estad√≠sticas de Deudores por Beneficio</h3>
                        <canvas id="graficoDeudores"></canvas>
                    </div>
                    
                    <div class="grafico-card">
                        <h3>üí∞ Eficiencia de Recaudaci√≥n</h3>
                        <canvas id="graficoEficiencia"></canvas>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button type="button" class="btn btn-volver" onclick="beneficiosSistema.volverAlSistema()">
                        ‚Üê Regresar al Sistema Principal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/beneficios.js"></script>
</body>
</html>