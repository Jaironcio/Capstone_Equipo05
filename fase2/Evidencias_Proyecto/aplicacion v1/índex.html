<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto SEIS - Sistema de Registro de Bomberos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="stylo.css">
</head>
<body>
    <!-- Pantalla de Login -->
    <div class="login-screen" id="loginScreen">
        <div class="background-particles" id="particles"></div>
        
        <div class="login-container">
            <h1 class="login-title">Login</h1>
            <form id="loginForm">
                <div class="login-form-group">
                    <label for="username" class="login-label">Usuario</label>
                    <input type="text" id="username" name="username" class="login-input" placeholder="Ingresa tu usuario" required>
                </div>
                
                <div class="login-form-group">
                    <label for="password" class="login-label">Password</label>
                    <input type="password" id="password" name="password" class="login-input" placeholder="Ingresa tu contrase√±a" required>
                </div>
                
                <button type="submit" class="submit-btn" id="submitBtn">
                    SUBMIT
                </button>
                
                <div class="error-message" id="errorMessage"></div>
                <div class="success-message" id="successMessage"></div>
            </form>
        </div>
    </div>

    <!-- Sistema Principal de Bomberos -->
    <div class="main-system" id="mainSystem">
        <div id="containerPrincipal" class="container">
            <div class="header">
                <div class="header-content">
                    <h1>üöí Proyecto SEIS</h1>
                    <p>Sistema de Registro de Bomberos - Hoja de Vida</p>
                </div>
                <div class="user-info-header" id="userInfoHeader">
                    <div id="userRoleInfo">Usuario</div>
                    <button class="logout-btn-header" id="logoutBtn">Cerrar Sesi√≥n</button>
                </div>
            </div>

            <div class="form-container">
                <div id="mensaje" class="success" style="display: none;"></div>
                
                <div id="modoEdicion" class="modo-edicion" style="display: none;">
                    <h3>üîÑ Modo Edici√≥n</h3>
                    <p>Est√° editando el registro de: <strong id="nombreEditando"></strong></p>
                    <button type="button" class="btn btn-secondary" onclick="cancelarEdicion()">Cancelar Edici√≥n</button>
                </div>
                
                <form id="formBombero">
                    <input type="hidden" id="idEditando" name="idEditando">
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="claveBombero" class="required">Clave del Bombero</label>
                            <input type="text" id="claveBombero" name="claveBombero" required 
                                   placeholder="Ej: 618-A, 425-B, 123-C">
                            <div class="error" id="error-claveBombero"></div>
                        </div>

                        <div class="form-group">
                            <label for="nombre" class="required">Nombre Completo</label>
                            <input type="text" id="nombre" name="nombre" required 
                                   placeholder="Ingrese nombre completo">
                            <div class="error" id="error-nombre"></div>
                        </div>

                        <div class="form-group">
                            <label for="fechaNacimiento" class="required">Fecha de Nacimiento</label>
                            <input type="date" id="fechaNacimiento" name="fechaNacimiento" required>
                            <div class="error" id="error-fechaNacimiento"></div>
                        </div>

                        <div class="form-group">
                            <label for="run" class="required">RUN Chileno</label>
                            <input type="text" id="run" name="run" required 
                                   placeholder="12.345.678-9" maxlength="12">
                            <div class="error" id="error-run"></div>
                        </div>

                        <div class="form-group">
                            <label for="profesion" class="required">Profesi√≥n u Oficio</label>
                            <input type="text" id="profesion" name="profesion" required 
                                   placeholder="Ingrese profesi√≥n u oficio">
                            <div class="error" id="error-profesion"></div>
                        </div>

                        <div class="form-group">
                            <label for="domicilio" class="required">Domicilio</label>
                            <input type="text" id="domicilio" name="domicilio" required 
                                   placeholder="Direcci√≥n completa">
                            <div class="error" id="error-domicilio"></div>
                        </div>

                        <div class="form-group">
                            <label for="nroRegistro" class="required">N√∫mero de Registro Nacional</label>
                            <input type="text" id="nroRegistro" name="nroRegistro" required 
                                   placeholder="N√∫mero de registro">
                            <div class="error" id="error-nroRegistro"></div>
                        </div>

                        <div class="form-group">
                            <label for="fechaIngreso" class="required">Fecha de Ingreso</label>
                            <input type="date" id="fechaIngreso" name="fechaIngreso" required>
                            <div class="error" id="error-fechaIngreso"></div>
                        </div>

                        <div class="form-group">
                            <label for="compania" class="required">Compa√±√≠a</label>
                            <input type="text" id="compania" name="compania" required 
                                   placeholder="Compa√±√≠a de bomberos">
                            <div class="error" id="error-compania"></div>
                        </div>

                        <div class="form-group">
                            <label for="grupoSanguineo" class="required">Grupo Sangu√≠neo</label>
                            <select id="grupoSanguineo" name="grupoSanguineo" required>
                                <option value="">Seleccione grupo sangu√≠neo</option>
                                <option value="A+">A+</option>
                                <option value="A-">A-</option>
                                <option value="B+">B+</option>
                                <option value="B-">B-</option>
                                <option value="AB+">AB+</option>
                                <option value="AB-">AB-</option>
                                <option value="O+">O+</option>
                                <option value="O-">O-</option>
                            </select>
                            <div class="error" id="error-grupoSanguineo"></div>
                        </div>

                        <div class="form-group">
                            <label for="telefono" class="required">N√∫mero de Tel√©fono</label>
                            <input type="tel" id="telefono" name="telefono" required 
                                   placeholder="+56 9 1234 5678">
                            <div class="error" id="error-telefono"></div>
                        </div>

                        <div class="form-group">
                            <label for="email" class="opcional">Correo Electr√≥nico</label>
                            <input type="email" id="email" name="email" 
                                   placeholder="ejemplo@correo.com">
                            <div class="error" id="error-email"></div>
                        </div>

                        <div class="form-group">
                            <label for="foto" class="opcional">Fotograf√≠a</label>
                            <input type="file" id="foto" name="foto" accept="image/*">
                            <div class="preview-container" id="previewContainer" style="display: none;">
                                <img id="previewImage" src="" alt="Vista previa" style="max-width: 150px; max-height: 150px; border-radius: 10px; margin-top: 10px; border: 2px solid #e0e0e0;">
                            </div>
                            <div class="error" id="error-foto"></div>
                        </div>

                        <h3 class="section-title">Informaci√≥n Adicional (Opcional)</h3>

                        <div class="form-group">
                            <label for="otrosCuerpos" class="opcional">Otros Cuerpos de Bomberos</label>
                            <input type="text" id="otrosCuerpos" name="otrosCuerpos" 
                                   placeholder="Otros cuerpos donde ha servido">
                        </div>

                        <div class="form-group">
                            <label for="companiaOpcional" class="opcional">Compa√±√≠a Adicional</label>
                            <input type="text" id="companiaOpcional" name="companiaOpcional" 
                                   placeholder="Compa√±√≠a adicional">
                        </div>

                        <div class="form-group">
                            <label for="desde" class="opcional">Desde</label>
                            <input type="date" id="desde" name="desde">
                        </div>

                        <div class="form-group">
                            <label for="hasta" class="opcional">Hasta</label>
                            <input type="date" id="hasta" name="hasta">
                        </div>
                    </div>

                    <div class="buttons">
                        <button type="submit" class="btn btn-primary" id="btnSubmit">Registrar Bombero</button>
                        <button type="button" class="btn btn-secondary" onclick="limpiarFormulario()">Limpiar Formulario</button>
                    </div>
                </form>

                <div class="registros">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                        <h3>Bomberos Registrados</h3>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn-info" onclick="toggleInfoCategorias()">
                                ‚ÑπÔ∏è Info Categor√≠as
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="toggleDatosEjemplo()" style="padding: 8px 15px; font-size: 0.9rem;">
                                üéØ Ejemplos Completos
                            </button>
                        </div>
                    </div>

                    <!-- Buscador -->
                    <div style="margin-bottom: 20px;">
                        <div class="form-group" style="margin: 0;">
                            <input type="text" id="buscadorBomberos" placeholder="üîç Buscar por nombre, clave, RUN, compa√±√≠a..." 
                                   style="width: 100%; padding: 12px 20px; border: 2px solid #e0e0e0; border-radius: 25px; font-size: 1rem; transition: all 0.3s ease;">
                        </div>
                    </div>

                    <div id="infoCategorias" class="info-categorias">
                        <h4>üìã Sistema de Categor√≠as por Antig√ºedad</h4>
                        <div class="categoria-explicacion">
                            <div style="border-left-color: #1976d2;">
                                <strong style="color: #1976d2;">üî∞ Voluntario</strong><br>
                                <small>Menos de 20 a√±os de servicio</small>
                            </div>
                            <div style="border-left-color: #388e3c;">
                                <strong style="color: #388e3c;">üèÖ Voluntario Honorario de Compa√±√≠a</strong><br>
                                <small>Entre 20 y 24 a√±os de servicio</small>
                            </div>
                            <div style="border-left-color: #f57c00;">
                                <strong style="color: #f57c00;">üéñÔ∏è Voluntario Honorario del Cuerpo</strong><br>
                                <small>Entre 25 y 49 a√±os de servicio</small>
                            </div>
                            <div style="border-left-color: #d32f2f;">
                                <strong style="color: #d32f2f;">üèÜ Voluntario Insigne de Chile</strong><br>
                                <small>50 a√±os o m√°s de servicio</small>
                            </div>
                        </div>
                        <p style="text-align: center; color: #666; font-size: 0.9rem; margin: 0;">
                            <em>Las categor√≠as se calculan autom√°ticamente bas√°ndose en la fecha de ingreso del bombero.</em>
                        </p>
                    </div>

                    <div class="contador">
                        Total de bomberos registrados: <strong id="totalBomberos">0</strong>
                    </div>
                    <div id="listaBomberos"></div>
                    <div class="scroll-hint" style="color: #666;">
                        ‚¨áÔ∏è Despl√°zate para ver m√°s bomberos
                    </div>
                </div>
            </div>
        </div>

        <!-- P√°gina de Cargos -->
        <div id="cargosContainer" class="container cargos-container">
            <div class="cargos-header">
                <h2>üëî SISTEMA DE CARGOS Y A√ëOS DE SERVICIO</h2>
                <p>Registro y Control de Cargos Desempe√±ados por Bomberos</p>
            </div>

            <div class="cargos-content">
                <div id="mensajeCargos" class="success mensaje-cargos" style="display: none;"></div>

                <div class="bombero-info">
                    <h3>üë§ Informaci√≥n del Bombero</h3>
                    <div class="bombero-datos">
                        <div><strong>Nombre Completo:</strong> <span id="cargoNombre">-</span></div>
                        <div><strong>Clave Bombero:</strong> <span id="cargoClave">-</span></div>
                        <div><strong>RUN:</strong> <span id="cargoRun">-</span></div>
                        <div><strong>Compa√±√≠a:</strong> <span id="cargoCompania">-</span></div>
                    </div>
                </div>

                <div class="form-cargos">
                    <h3>üìã Registro de Nuevo Cargo</h3>
                    
                    <form id="formCargo">
                        <input type="hidden" id="bomberoCargoId" name="bomberoCargoId">
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="a√±oCargo" class="opcional">A√±o</label>
                                <input type="number" id="a√±oCargo" name="a√±oCargo" min="1950" max="2030"
                                       placeholder="Ej: 2024">
                                <div class="error" id="error-a√±oCargo"></div>
                            </div>

                            <div class="form-group">
                                <label for="tipoCargo" class="opcional">Cargo</label>
                                <select id="tipoCargo" name="tipoCargo">
                                    <option value="">Seleccione un cargo (opcional)</option>
                                    <option value="Capit√°n">Capit√°n</option>
                                    <option value="Teniente Primero">Teniente Primero</option>
                                    <option value="Teniente Segundo">Teniente Segundo</option>
                                    <option value="Teniente Tercero">Teniente Tercero</option>
                                    <option value="Teniente Cuarto">Teniente Cuarto</option>
                                    <option value="Tesorero">Tesorero</option>
                                    <option value="Secretario">Secretario</option>
                                    <option value="Jefe de M√°quinas">Jefe de M√°quinas</option>
                                    <option value="Ayudante de Compa√±√≠a">Ayudante de Compa√±√≠a</option>
                                    <option value="Director">Director</option>
                                    <option value="Intendente">Intendente</option>
                                </select>
                                <div class="error" id="error-tipoCargo"></div>
                            </div>

                            <div class="form-group">
                                <label for="fechaInicioCargo" class="opcional">Desde</label>
                                <input type="date" id="fechaInicioCargo" name="fechaInicioCargo">
                                <div class="error" id="error-fechaInicioCargo"></div>
                            </div>

                            <div class="form-group">
                                <label for="fechaFinCargo" class="opcional">Hasta</label>
                                <input type="date" id="fechaFinCargo" name="fechaFinCargo">
                                <div class="error" id="error-fechaFinCargo"></div>
                            </div>

                            <div class="form-group">
                                <label for="premioA√±oServicio" class="opcional">Premio A√±o Servicio</label>
                                <input type="text" id="premioA√±oServicio" name="premioA√±oServicio"
                                       placeholder="Especificar premio o reconocimiento">
                                <div class="error" id="error-premioA√±oServicio"></div>
                            </div>

                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label for="observacionesCargo" class="opcional">Observaciones / Otros Cargos Ocupados en el Mismo A√±o Calendario</label>
                                <textarea id="observacionesCargo" name="observacionesCargo" rows="3" 
                                          placeholder="Observaciones adicionales u otros cargos desempe√±ados en el mismo a√±o"></textarea>
                                <div class="error" id="error-observacionesCargo"></div>
                            </div>

                            <div style="grid-column: 1 / -1; background: rgba(255, 152, 0, 0.1); border: 2px solid rgba(255, 152, 0, 0.3); border-radius: 10px; padding: 15px; margin: 10px 0;">
                                <p style="color: #ff9800; font-weight: 500; margin: 0; text-align: center;">
                                    üí° <strong>Nota:</strong> Debe completar al menos uno de los siguientes campos: <strong>A√±o</strong>, <strong>Cargo</strong> o <strong>Desde</strong>
                                </p>
                            </div>
                        </div>

                        <div class="buttons">
                            <button type="submit" class="btn-cargo">Registrar Cargo</button>
                            <button type="button" class="btn btn-secondary" onclick="limpiarFormularioCargo()">Limpiar Formulario</button>
                        </div>
                    </form>
                </div>

                <div class="cargos-list">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; flex-shrink: 0;">
                        <h3 style="color: #ffffff; margin-bottom: 20px; font-size: 1.3rem; font-weight: 300; text-align: center;">üìö Historial de Cargos</h3>
                        <button type="button" class="btn-excel" onclick="exportarCargosExcel()">
                            üìä Descargar Excel
                        </button>
                    </div>
                    <div class="contador" style="color: rgba(255, 255, 255, 0.8); text-align: center; margin-bottom: 25px; font-size: 1rem; flex-shrink: 0;">
                        Total de cargos registrados: <strong id="totalCargos" style="color: #ff9800; font-weight: 600;">0</strong>
                    </div>
                    <div id="listaCargos" style="flex: 1; overflow-y: auto; max-height: 60vh; padding-right: 10px; margin-right: -10px;"></div>
                    <div class="scroll-hint">
                        ‚¨áÔ∏è Despl√°zate para ver m√°s cargos
                    </div>
                </div>

                <div class="buttons" style="margin-top: 40px; text-align: center;">
                    <button type="button" class="btn-volver" onclick="volverAListaBomberosDesdeCargos()">
                        ‚Üê Regresar al Sistema Principal
                    </button>
                </div>
            </div>
        </div>

        <!-- P√°gina de Sanciones ACTUALIZADA -->
        <div id="sancionesContainer" class="container sanciones-container">
            <div class="sanciones-header">
                <h2>‚öñÔ∏è SISTEMA DE SANCIONES DISCIPLINARIAS</h2>
                <p>Registro y Control de Medidas Disciplinarias Institucionales</p>
            </div>

            <div class="sanciones-content">
                <div id="mensajeSanciones" class="success mensaje-sanciones" style="display: none;"></div>

                <div class="bombero-info">
                    <h3>üë§ Informaci√≥n del Bombero</h3>
                    <div class="bombero-datos">
                        <div><strong>Nombre Completo:</strong> <span id="sancionNombre">-</span></div>
                        <div><strong>Clave Bombero:</strong> <span id="sancionClave">-</span></div>
                        <div><strong>RUN:</strong> <span id="sancionRun">-</span></div>
                        <div><strong>Compa√±√≠a:</strong> <span id="sancionCompania">-</span></div>
                    </div>
                </div>

                <div class="form-sanciones">
                    <h3>üìã Registro de Nueva Sanci√≥n Disciplinaria</h3>
                    
                    <form id="formSancion">
                        <input type="hidden" id="bomberoSancionId" name="bomberoSancionId">
                        
                        <div class="tipo-sancion">
                            <label>
                                <input type="radio" name="tipoSancion" value="renuncia" required>
                                <span>üìù Renuncia</span>
                            </label>
                            <label>
                                <input type="radio" name="tipoSancion" value="suspension" required>
                                <span>‚è∏Ô∏è Suspensi√≥n</span>
                            </label>
                            <label>
                                <input type="radio" name="tipoSancion" value="separacion" required>
                                <span>‚ÜóÔ∏è Separaci√≥n</span>
                            </label>
                            <label>
                                <input type="radio" name="tipoSancion" value="expulsion" required>
                                <span>‚ùå Expulsi√≥n</span>
                            </label>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="companiaAutoridad" class="opcional">Compa√±√≠a Responsable</label>
                                <input type="text" id="companiaAutoridad" name="companiaAutoridad" 
                                       placeholder="Especificar si la sanci√≥n es impuesta por compa√±√≠a">
                                <div class="error" id="error-companiaAutoridad"></div>
                            </div>

                            <div class="form-group">
                                <label for="autoridadSancionatoria" class="opcional">Autoridad Sancionatoria</label>
                                <select id="autoridadSancionatoria" name="autoridadSancionatoria">
                                    <option value="">Seleccione autoridad sancionatoria (opcional)</option>
                                    <option value="Consejo Superior de Disciplina">Consejo Superior de Disciplina</option>
                                    <option value="Consejo de Disciplina de C√≠a">Consejo de Disciplina de C√≠a</option>
                                </select>
                                <div class="error" id="error-autoridadSancionatoria"></div>
                            </div>

                            <div class="form-group">
                                <label for="fechaDesde" class="required">Fecha de Inicio</label>
                                <input type="date" id="fechaDesde" name="fechaDesde" required onchange="calcularFechaTermino()">
                                <div class="error" id="error-fechaDesde"></div>
                            </div>

                            <div class="form-group">
                                <label for="diasSancion" class="opcional">D√≠as de Sanci√≥n</label>
                                <input type="number" id="diasSancion" name="diasSancion" min="1" max="365" onchange="calcularFechaTermino()" placeholder="N√∫mero de d√≠as">
                                <div class="error" id="error-diasSancion"></div>
                                <div class="info-calculo">
                                    ‚ö° Si especifica los d√≠as de sanci√≥n, la fecha de t√©rmino se calcular√° autom√°ticamente
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="fechaHasta" class="opcional">Fecha de T√©rmino</label>
                                <input type="date" id="fechaHasta" name="fechaHasta">
                                <div class="error" id="error-fechaHasta"></div>
                            </div>

                            <div class="form-group">
                                <label for="oficioNumero" class="required">Identificador del Oficio</label>
                                <input type="text" id="oficioNumero" name="oficioNumero" required 
                                       placeholder="ID √∫nico del documento oficial">
                                <div class="error" id="error-oficioNumero"></div>
                            </div>

                            <div class="form-group">
                                <label for="fechaOficio" class="opcional">Fecha de Registro Oficial</label>
                                <input type="date" id="fechaOficio" name="fechaOficio" readonly class="input-automatico">
                                <div class="error" id="error-fechaOficio"></div>
                                <div class="info-automatico">
                                    üìÖ Se establece autom√°ticamente con la fecha actual
                                </div>
                            </div>

                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label for="motivo" class="required">Descripci√≥n del Motivo</label>
                                <textarea id="motivo" name="motivo" required rows="4" 
                                          placeholder="Describa detalladamente el motivo y circunstancias de la sanci√≥n disciplinaria"></textarea>
                                <div class="error" id="error-motivo"></div>
                            </div>
                        </div>

                        <div class="buttons">
                            <button type="submit" class="btn-sancion">Registrar Sanci√≥n</button>
                            <button type="button" class="btn btn-secondary" onclick="limpiarFormularioSancion()">Limpiar Formulario</button>
                        </div>
                    </form>
                </div>

                <div class="sanciones-list">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; flex-shrink: 0;">
                        <h3 style="color: #ffffff; margin-bottom: 20px; font-size: 1.3rem; font-weight: 300; text-align: center;">üìö Historial de Sanciones Disciplinarias</h3>
                        <button type="button" class="btn-excel" onclick="exportarSancionesExcel()">
                            üìä Descargar Excel
                        </button>
                        
<div class="buttons" style="margin-top: 20px;">
  <button type="button" class="btn-excel" onclick="generarPDF()">
    üìÑ Generar Ficha PDF
  </button>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<script>
              

                            
function generarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // === DATOS DEL VOLUNTARIO (secci√≥n sanciones, no inputs del form) ===
  const nombre = document.getElementById("sancionNombre")?.innerText || "-";
  const run = document.getElementById("sancionRun")?.innerText || "-";
  const clave = document.getElementById("sancionClave")?.innerText || "-";
  const compania = document.getElementById("sancionCompania")?.innerText || "-";
  const fechaIngreso = document.getElementById("sancionFechaIngreso")?.innerText || "";

  // === C√ÅLCULO DE ANTIG√úEDAD ===
  let antiguedad = "-";
  if (fechaIngreso) {
    const ingresoDate = new Date(fechaIngreso);
    if (!isNaN(ingresoDate)) {
      const hoy = new Date();
      let a√±os = hoy.getFullYear() - ingresoDate.getFullYear();
      const mes = hoy.getMonth() - ingresoDate.getMonth();
      if (mes < 0 || (mes === 0 && hoy.getDate() < ingresoDate.getDate())) {
        a√±os--; 
      }
      antiguedad = `${a√±os} A√ëOS`;
    }
  }

  // === FOTO ===
  const imgElement = document.getElementById("previewImage");
  if (imgElement && imgElement.src) {
    doc.addImage(imgElement, "JPEG", 150, 25, 40, 40);
  }

  // === ENCABEZADO ===
  doc.setFontSize(14);
  doc.setTextColor(0, 0, 150);
  doc.text("FICHA PERSONAL DE VOLUNTARIO", 105, 15, { align: "center" });

  doc.setFontSize(11);
  doc.setTextColor(0, 0, 0);
  doc.text(`NOMBRES: ${nombre}`, 20, 40);
  doc.text(`RUT: ${run}`, 20, 50);
  doc.text(`CLAVE: ${clave}`, 20, 60);
  doc.text(`COMPA√ë√çA: ${compania}`, 20, 70);

  doc.text(`Fecha Ingreso: ${fechaIngreso || "-"}`, 20, 85);
  doc.text(`Antig√ºedad: ${antiguedad}`, 120, 85);

  // === TABLA DE SANCIONES ===
  const sanciones = [];
  document.querySelectorAll("#listaSanciones .sancion-card").forEach(card => {
    const fecha = card.querySelector(".sancion-fecha")?.innerText.replace(/[^0-9/]/g, "") || "-";
    const dias = card.querySelector(".sancion-dias")?.innerText.replace(/[^0-9 d√≠asA√ëOS]/gi, "") || "-";
    const tipo = card.querySelector(".sancion-tipo")?.innerText.replace(/[^a-zA-Z√Å√â√ç√ì√ö√ë√°√©√≠√≥√∫ ]/g, "") || "-";
    sanciones.push([fecha, dias, tipo]);
  });

  doc.setTextColor(200, 0, 0);
  doc.setFontSize(13);
  doc.text("SANCIONES DE VOLUNTARIO", 105, 105, { align: "center" });

  doc.autoTable({
    head: [["Fecha de Sanci√≥n", "D√≠as de sanci√≥n", "Tipo de Sanci√≥n"]],
    body: sanciones,
    startY: 110,
    headStyles: { fillColor: [200, 0, 0], halign: "center", textColor: 255 },
    bodyStyles: { halign: "center" },
  });

  // === DESCARGA ===
  doc.save(`Ficha_${nombre || "Voluntario"}.pdf`);
}
</script>

                    </div>
                    <div class="contador" style="color: rgba(255, 255, 255, 0.8); text-align: center; margin-bottom: 25px; font-size: 1rem; flex-shrink: 0;">
                        Total de sanciones registradas: <strong id="totalSanciones" style="color: #00bcd4; font-weight: 600;">0</strong>
                    </div>
                    <div id="listaSanciones" style="flex: 1; overflow-y: auto; max-height: 60vh; padding-right: 10px; margin-right: -10px;"></div>
                    <div class="scroll-hint">
                        ‚¨áÔ∏è Despl√°zate para ver m√°s sanciones
                    </div>
                </div>

                <div class="buttons" style="margin-top: 40px; text-align: center;">
                    <button type="button" class="btn-volver" onclick="volverAListaBomberos()">
                        ‚Üê Regresar al Sistema Principal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== SISTEMA DE LOGIN ====================
        const users = {
            'director': { password: 'dir2024', role: 'Director' },
            'secretario': { password: 'sec2024', role: 'Secretario' },
            'tesorero': { password: 'tes2024', role: 'Tesorero' },
            'capitan': { password: 'cap2024', role: 'Capit√°n' },
            'ayudante': { password: 'ayu2024', role: 'Ayudante' },
            'superadmin': { password: 'admin2024', role: 'Super Administrador' }
        };

        let currentUser = null;

        // Crear part√≠culas de fondo
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Manejar el login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim().toLowerCase();
            const password = document.getElementById('password').value;
            const submitBtn = document.getElementById('submitBtn');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            
            // Limpiar mensajes previos
            errorMessage.classList.remove('show');
            successMessage.classList.remove('show');
            
            // Agregar estado de carga
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'VALIDANDO...';
            
            // Simular delay de autenticaci√≥n
            setTimeout(() => {
                if (users[username] && users[username].password === password) {
                    // Login exitoso
                    currentUser = { username: username, ...users[username] };
                    successMessage.textContent = `¬°Bienvenido, ${users[username].role}!`;
                    successMessage.classList.add('show');
                    
                    // Mostrar el sistema despu√©s del login exitoso
                    setTimeout(() => {
                        showMainSystem();
                    }, 1500);
                } else {
                    // Login fallido
                    errorMessage.textContent = 'Usuario o contrase√±a incorrectos';
                    errorMessage.classList.add('show');
                    
                    // Efecto de shake en el container
                    document.querySelector('.login-container').style.animation = 'shake 0.5s ease-in-out';
                    setTimeout(() => {
                        document.querySelector('.login-container').style.animation = '';
                    }, 500);
                }
                
                // Remover estado de carga
                submitBtn.classList.remove('loading');
                submitBtn.textContent = 'SUBMIT';
            }, 1500);
        });

        // Mostrar sistema principal
        function showMainSystem() {
            const loginScreen = document.getElementById('loginScreen');
            const mainSystem = document.getElementById('mainSystem');
            
            // Ocultar login
            loginScreen.classList.add('hidden');
            
            // Mostrar sistema
            setTimeout(() => {
                mainSystem.classList.add('show');
                updateUserInfo();
            }, 300);
        }

        // Actualizar informaci√≥n del usuario
        function updateUserInfo() {
            if (currentUser) {
                const userInfo = document.getElementById('userInfoHeader');
                const userRoleInfo = document.getElementById('userRoleInfo');
                userRoleInfo.textContent = `${currentUser.role}: ${currentUser.username}`;
            }
        }

        // Manejar logout
        function logout() {
            currentUser = null;
            const loginScreen = document.getElementById('loginScreen');
            const mainSystem = document.getElementById('mainSystem');
            
            // Ocultar sistema
            mainSystem.classList.remove('show');
            
            // Mostrar login
            setTimeout(() => {
                loginScreen.classList.remove('hidden');
                
                // Limpiar formulario
                document.getElementById('loginForm').reset();
                document.getElementById('errorMessage').classList.remove('show');
                document.getElementById('successMessage').classList.remove('show');
                
                // Resetear a p√°gina principal del sistema
                document.getElementById('containerPrincipal').style.display = 'block';
                document.getElementById('sancionesContainer').style.display = 'none';
                document.getElementById('cargosContainer').style.display = 'none';
            }, 300);
        }

        // Event listener para logout
        document.getElementById('logoutBtn').addEventListener('click', logout);

        // ==================== SISTEMA DE BOMBEROS ====================
        let bomberos = [];
        let sanciones = [];
        let cargos = [];
        let idCounter = 1;
        let sancionIdCounter = 1;
        let cargoIdCounter = 1;
        let editandoId = null;
        let bomberoSancionActual = null;
        let bomberoCargoActual = null;
        let terminoBusqueda = '';

        // NUEVA: Funci√≥n para calcular fecha de t√©rmino autom√°ticamente
        function calcularFechaTermino() {
            const fechaDesde = document.getElementById('fechaDesde').value;
            const diasSancion = document.getElementById('diasSancion').value;
            const fechaHasta = document.getElementById('fechaHasta');
            
            if (fechaDesde && diasSancion) {
                const fechaInicio = new Date(fechaDesde);
                const fechaFin = new Date(fechaInicio);
                fechaFin.setDate(fechaInicio.getDate() + parseInt(diasSancion));
                
                // Formatear fecha para input date (YYYY-MM-DD)
                const fechaFormateada = fechaFin.toISOString().split('T')[0];
                fechaHasta.value = fechaFormateada;
                fechaHasta.classList.add('campo-calculado');
            } else {
                fechaHasta.classList.remove('campo-calculado');
            }
        }

        // NUEVA: Funci√≥n para establecer fecha autom√°tica
        function establecerFechaAutomatica() {
            const fechaRegistro = document.getElementById('fechaOficio');
            const hoy = new Date().toISOString().split('T')[0];
            fechaRegistro.value = hoy;
        }

        // Funci√≥n para filtrar bomberos
        function filtrarBomberos(listaBomberos) {
            if (!terminoBusqueda) return listaBomberos;
            
            return listaBomberos.filter(bombero => {
                return bombero.nombre.toLowerCase().includes(terminoBusqueda) ||
                       bombero.claveBombero.toLowerCase().includes(terminoBusqueda) ||
                       bombero.run.toLowerCase().includes(terminoBusqueda) ||
                       bombero.compania.toLowerCase().includes(terminoBusqueda) ||
                       bombero.profesion.toLowerCase().includes(terminoBusqueda) ||
                       bombero.domicilio.toLowerCase().includes(terminoBusqueda) ||
                       (bombero.email && bombero.email.toLowerCase().includes(terminoBusqueda));
            });
        }

        // Calcular antig√ºedad detallada
        function calcularAntiguedadDetallada(fechaIngreso) {
            const hoy = new Date();
            const ingreso = new Date(fechaIngreso);
            
            let a√±os = hoy.getFullYear() - ingreso.getFullYear();
            let meses = hoy.getMonth() - ingreso.getMonth();
            let d√≠as = hoy.getDate() - ingreso.getDate();
            
            if (d√≠as < 0) {
                meses--;
                const ultimoDiaMesAnterior = new Date(hoy.getFullYear(), hoy.getMonth(), 0).getDate();
                d√≠as += ultimoDiaMesAnterior;
            }
            
            if (meses < 0) {
                a√±os--;
                meses += 12;
            }
            
            return { a√±os, meses, d√≠as };
        }

        // Calcular edad
        function calcularEdad(fechaNacimiento) {
            const hoy = new Date();
            const nacimiento = new Date(fechaNacimiento);
            let edad = hoy.getFullYear() - nacimiento.getFullYear();
            const mes = hoy.getMonth() - nacimiento.getMonth();
            if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) {
                edad--;
            }
            return edad;
        }

        // Calcular categor√≠a de bombero
        function calcularCategoriaBombero(fechaIngreso) {
            const antiguedad = calcularAntiguedadDetallada(fechaIngreso);
            const anosCompletos = antiguedad.a√±os;
            
            if (anosCompletos < 20) {
                return { categoria: 'Voluntario', color: '#1976d2', icono: 'üî∞' };
            } else if (anosCompletos >= 20 && anosCompletos <= 24) {
                return { categoria: 'Voluntario Honorario de Compa√±√≠a', color: '#388e3c', icono: 'üèÖ' };
            } else if (anosCompletos >= 25 && anosCompletos <= 49) {
                return { categoria: 'Voluntario Honorario del Cuerpo', color: '#f57c00', icono: 'üéñÔ∏è' };
            } else {
                return { categoria: 'Voluntario Insigne de Chile', color: '#d32f2f', icono: 'üèÜ' };
            }
        }

        // Renderizar lista de bomberos
        function renderizarBomberos() {
            const lista = document.getElementById('listaBomberos');
            const total = document.getElementById('totalBomberos');
            
            const bomberosFiltrados = filtrarBomberos(bomberos);
            total.textContent = bomberosFiltrados.length;
            
            if (bomberos.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666;">No hay bomberos registrados</p>';
                return;
            }
            
            if (bomberosFiltrados.length === 0 && terminoBusqueda) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No se encontraron bomberos que coincidan con la b√∫squeda</p>';
                return;
            }

            // Calcular estad√≠sticas de categor√≠as
            const categorias = { voluntario: 0, honorarioCompania: 0, honorarioCuerpo: 0, insigne: 0 };
            bomberosFiltrados.forEach(bombero => {
                const antiguedad = calcularAntiguedadDetallada(bombero.fechaIngreso);
                const anos = antiguedad.a√±os;
                if (anos < 20) categorias.voluntario++;
                else if (anos >= 20 && anos <= 24) categorias.honorarioCompania++;
                else if (anos >= 25 && anos <= 49) categorias.honorarioCuerpo++;
                else categorias.insigne++;
            });
            
            const bomberosOrdenados = [...bomberosFiltrados].sort((a, b) => {
                const antiguedadA = calcularAntiguedadDetallada(a.fechaIngreso).a√±os;
                const antiguedadB = calcularAntiguedadDetallada(b.fechaIngreso).a√±os;
                return antiguedadB - antiguedadA;
            });
            
            const mensajeBusqueda = terminoBusqueda ? 
                `<div style="background: #e3f2fd; border: 2px solid #1976d2; border-radius: 10px; padding: 15px; margin-bottom: 20px; text-align: center;">
                    <strong>üîç Mostrando ${bomberosFiltrados.length} resultado(s) para: "${terminoBusqueda}"</strong>
                    ${bomberosFiltrados.length < bomberos.length ? `<br><small>Total de bomberos registrados: ${bomberos.length}</small>` : ''}
                </div>` : '';
            
            lista.innerHTML = mensajeBusqueda + `
                <div class="resumen-categorias">
                    <div class="categoria-item" style="border-color: #1976d2; color: #1976d2;">
                        <div class="numero">${categorias.voluntario}</div>
                        <div class="nombre">üî∞ Voluntarios</div>
                    </div>
                    <div class="categoria-item" style="border-color: #388e3c; color: #388e3c;">
                        <div class="numero">${categorias.honorarioCompania}</div>
                        <div class="nombre">üèÖ Hon. Compa√±√≠a</div>
                    </div>
                    <div class="categoria-item" style="border-color: #f57c00; color: #f57c00;">
                        <div class="numero">${categorias.honorarioCuerpo}</div>
                        <div class="nombre">üéñÔ∏è Hon. Cuerpo</div>
                    </div>
                    <div class="categoria-item" style="border-color: #d32f2f; color: #d32f2f;">
                        <div class="numero">${categorias.insigne}</div>
                        <div class="nombre">üèÜ Insignes</div>
                    </div>
                </div>
            ` + bomberosOrdenados.map((bombero, index) => `
                <div class="registro-card">
                    <div class="registro-foto">
                        ${bombero.foto ? 
                            `<img src="${bombero.foto}" alt="Foto de ${bombero.nombre}">` :
                            `<div class="sin-foto">Sin foto</div>`
                        }
                        <div style="text-align: center; margin-top: 5px; font-size: 0.8rem; color: #1976d2; font-weight: bold;">
                            #${index + 1}${terminoBusqueda ? ' (filtrado)' : ''}
                        </div>
                    </div>
                    <div class="registro-contenido">
                        <div class="registro-header">
                            <div>
                                <div class="registro-nombre">${bombero.nombre}</div>
                                <div class="registro-run">Clave: ${bombero.claveBombero} | RUN: ${bombero.run}</div>
                            </div>
                            <div>
                                <button class="btn-cargos" onclick="verCargos(${bombero.id})">Cargos</button>
                                <button class="btn-sanciones" onclick="verSanciones(${bombero.id})">Sanciones</button>
                                <button class="btn-edit" onclick="editarBombero(${bombero.id})">Editar</button>
                                <button class="btn-delete" onclick="eliminarBombero(${bombero.id})">Eliminar</button>
                            </div>
                        </div>
                        <div class="registro-info">
                            <div><strong>Edad:</strong> <span>${calcularEdad(bombero.fechaNacimiento)} a√±os</span></div>
                            <div><strong>Antig√ºedad:</strong> <span>${(() => {
                                const antiguedad = calcularAntiguedadDetallada(bombero.fechaIngreso);
                                let texto = '';
                                if (antiguedad.a√±os > 0) texto += `${antiguedad.a√±os} a√±o${antiguedad.a√±os !== 1 ? 's' : ''}`;
                                if (antiguedad.meses > 0) texto += `${texto ? ', ' : ''}${antiguedad.meses} mes${antiguedad.meses !== 1 ? 'es' : ''}`;
                                if (antiguedad.d√≠as > 0) texto += `${texto ? ', ' : ''}${antiguedad.d√≠as} d√≠a${antiguedad.d√≠as !== 1 ? 's' : ''}`;
                                return texto || '0 d√≠as';
                            })()}</span></div>
                            <div style="grid-column: 1 / -1; margin: 10px 0; padding: 8px; background: ${(() => {
                                const categoria = calcularCategoriaBombero(bombero.fechaIngreso);
                                return categoria.color + '20';
                            })()}; border-left: 4px solid ${(() => {
                                const categoria = calcularCategoriaBombero(bombero.fechaIngreso);
                                return categoria.color;
                            })()}; border-radius: 5px;">
                                <strong style="color: ${(() => {
                                    const categoria = calcularCategoriaBombero(bombero.fechaIngreso);
                                    return categoria.color;
                                })()};">
                                    ${(() => {
                                        const categoria = calcularCategoriaBombero(bombero.fechaIngreso);
                                        return categoria.icono + ' ' + categoria.categoria;
                                    })()}
                                </strong>
                            </div>
                            <div><strong>Profesi√≥n:</strong> <span>${bombero.profesion}</span></div>
                            <div><strong>Domicilio:</strong> <span>${bombero.domicilio}</span></div>
                            <div><strong>Registro Nacional:</strong> <span>${bombero.nroRegistro}</span></div>
                            <div><strong>Fecha Ingreso:</strong> <span>${new Date(bombero.fechaIngreso).toLocaleDateString()}</span></div>
                            <div><strong>Compa√±√≠a:</strong> <span>${bombero.compania}</span></div>
                            <div><strong>Grupo Sangu√≠neo:</strong> <span>${bombero.grupoSanguineo}</span></div>
                            <div><strong>Tel√©fono:</strong> <span><a href="tel:${bombero.telefono}" style="color: #1976d2; text-decoration: none;">${bombero.telefono}</a></span></div>
                            ${bombero.email ? `<div><strong>Email:</strong> <span><a href="mailto:${bombero.email}" style="color: #1976d2; text-decoration: none;">${bombero.email}</a></span></div>` : '<div><strong>Email:</strong> <span style="color: #666; font-style: italic;">No registrado</span></div>'}
                            ${bombero.otrosCuerpos ? `<div><strong>Otros Cuerpos:</strong> <span>${bombero.otrosCuerpos}</span></div>` : ''}
                            ${bombero.companiaOpcional ? `<div><strong>Compa√±√≠a Adicional:</strong> <span>${bombero.companiaOpcional}</span></div>` : ''}
                            ${bombero.desde ? `<div><strong>Desde:</strong> <span>${new Date(bombero.desde).toLocaleDateString()}</span></div>` : ''}
                            ${bombero.hasta ? `<div><strong>Hasta:</strong> <span>${new Date(bombero.hasta).toLocaleDateString()}</span></div>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Funci√≥n para mostrar mensaje
        function mostrarMensaje(mensaje, tipo = 'success') {
            const sancionesVisible = document.getElementById('sancionesContainer').style.display === 'block';
            const cargosVisible = document.getElementById('cargosContainer').style.display === 'block';
            
            let elementoId = 'mensaje';
            if (sancionesVisible) {
                elementoId = 'mensajeSanciones';
            } else if (cargosVisible) {
                elementoId = 'mensajeCargos';
            }
            
            const elemento = document.getElementById(elementoId);
            elemento.textContent = mensaje;
            elemento.className = tipo === 'error' ? 'error-message' : 'success';
            elemento.style.display = 'block';
            
            setTimeout(() => {
                elemento.style.display = 'none';
            }, 5000);
        }

        // Datos de ejemplo para mostrar cada categor√≠a
        function cargarDatosEjemplo() {
            const hoy = new Date();
            
            const fechaIngreso1 = new Date(hoy.getFullYear() - 5, hoy.getMonth(), hoy.getDate());
            const fechaNacimiento1 = new Date(hoy.getFullYear() - 28, 5, 15);
            
            const fechaIngreso2 = new Date(hoy.getFullYear() - 22, hoy.getMonth(), hoy.getDate());
            const fechaNacimiento2 = new Date(hoy.getFullYear() - 47, 8, 20);
            
            const fechaIngreso3 = new Date(hoy.getFullYear() - 30, hoy.getMonth(), hoy.getDate());
            const fechaNacimiento3 = new Date(hoy.getFullYear() - 55, 3, 10);
            
            const fechaIngreso4 = new Date(hoy.getFullYear() - 52, hoy.getMonth(), hoy.getDate());
            const fechaNacimiento4 = new Date(hoy.getFullYear() - 75, 12, 5);

            const fechaIngreso5 = new Date(hoy.getFullYear() - 2, hoy.getMonth(), hoy.getDate());
            const fechaNacimiento5 = new Date(hoy.getFullYear() - 25, 9, 8);

            const fechaIngreso6 = new Date(hoy.getFullYear() - 35, hoy.getMonth(), hoy.getDate());
            const fechaNacimiento6 = new Date(hoy.getFullYear() - 60, 7, 18);

            const ejemplos = [
                {
                    id: idCounter++,
                    claveBombero: "618-A",
                    nombre: "Carlos Eduardo Morales Silva",
                    fechaNacimiento: fechaNacimiento1.toISOString().split('T')[0],
                    run: "19.876.543-2",
                    profesion: "Ingeniero Civil",
                    domicilio: "Av. Providencia 1234, Providencia",
                    nroRegistro: "REG-2019-001",
                    fechaIngreso: fechaIngreso1.toISOString().split('T')[0],
                    compania: "Primera Compa√±√≠a",
                    grupoSanguineo: "O+",
                    telefono: "+56 9 8765 4321",
                    email: "carlos.morales@email.com",
                    foto: null,
                    otrosCuerpos: "",
                    companiaOpcional: "",
                    desde: "",
                    hasta: "",
                    fechaRegistro: new Date().toISOString()
                },
                {
                    id: idCounter++,
                    claveBombero: "425-B",
                    nombre: "Mar√≠a Teresa Gonz√°lez Rodr√≠guez",
                    fechaNacimiento: fechaNacimiento2.toISOString().split('T')[0],
                    run: "15.234.567-8",
                    profesion: "Profesora de Educaci√≥n B√°sica",
                    domicilio: "Calle Los Aromos 567, Las Condes",
                    nroRegistro: "REG-2002-045",
                    fechaIngreso: fechaIngreso2.toISOString().split('T')[0],
                    compania: "Segunda Compa√±√≠a",
                    grupoSanguineo: "A+",
                    telefono: "+56 9 7654 3210",
                    email: "maria.gonzalez@email.com",
                    foto: null,
                    otrosCuerpos: "",
                    companiaOpcional: "",
                    desde: "",
                    hasta: "",
                    fechaRegistro: new Date().toISOString()
                },
                {
                    id: idCounter++,
                    claveBombero: "123-C",
                    nombre: "Roberto Antonio Fern√°ndez L√≥pez",
                    fechaNacimiento: fechaNacimiento3.toISOString().split('T')[0],
                    run: "12.345.678-9",
                    profesion: "Contador Auditor",
                    domicilio: "Pasaje San Mart√≠n 890, √ëu√±oa",
                    nroRegistro: "REG-1994-023",
                    fechaIngreso: fechaIngreso3.toISOString().split('T')[0],
                    compania: "Tercera Compa√±√≠a",
                    grupoSanguineo: "B+",
                    telefono: "+56 9 6543 2109",
                    email: "roberto.fernandez@email.com",
                    foto: null,
                    otrosCuerpos: "Cuerpo de Bomberos de Valpara√≠so",
                    companiaOpcional: "Quinta Compa√±√≠a",
                    desde: "1990-03-15",
                    hasta: "1994-08-20",
                    fechaRegistro: new Date().toISOString()
                },
                {
                    id: idCounter++,
                    claveBombero: "001-D",
                    nombre: "Manuel Alejandro Pe√±a Morales",
                    fechaNacimiento: fechaNacimiento4.toISOString().split('T')[0],
                    run: "8.765.432-1",
                    profesion: "M√©dico Cirujano (Jubilado)",
                    domicilio: "Av. Las Flores 234, Vitacura",
                    nroRegistro: "REG-1972-001",
                    fechaIngreso: fechaIngreso4.toISOString().split('T')[0],
                    compania: "Primera Compa√±√≠a",
                    grupoSanguineo: "AB+",
                    telefono: "+56 9 5432 1098",
                    email: "manuel.pena@email.com",
                    foto: null,
                    otrosCuerpos: "",
                    companiaOpcional: "",
                    desde: "",
                    hasta: "",
                    fechaRegistro: new Date().toISOString()
                },
                {
                    id: idCounter++,
                    claveBombero: "789-E",
                    nombre: "Francisca Alejandra Soto Vargas",
                    fechaNacimiento: fechaNacimiento5.toISOString().split('T')[0],
                    run: "21.987.654-3",
                    profesion: "Dise√±adora Gr√°fica",
                    domicilio: "Calle Nueva 456, Santiago Centro",
                    nroRegistro: "REG-2022-078",
                    fechaIngreso: fechaIngreso5.toISOString().split('T')[0],
                    compania: "Cuarta Compa√±√≠a",
                    grupoSanguineo: "O-",
                    telefono: "+56 9 4321 0987",
                    email: "francisca.soto@email.com",
                    foto: null,
                    otrosCuerpos: "",
                    companiaOpcional: "",
                    desde: "",
                    hasta: "",
                    fechaRegistro: new Date().toISOString()
                },
                {
                    id: idCounter++,
                    claveBombero: "345-F",
                    nombre: "Luis Fernando Castro Mu√±oz",
                    fechaNacimiento: fechaNacimiento6.toISOString().split('T')[0],
                    run: "11.222.333-4",
                    profesion: "T√©cnico en Electr√≥nica",
                    domicilio: "Villa Los Pinos 123, Maip√∫",
                    nroRegistro: "REG-1989-056",
                    fechaIngreso: fechaIngreso6.toISOString().split('T')[0],
                    compania: "Quinta Compa√±√≠a",
                    grupoSanguineo: "A-",
                    telefono: "+56 9 3210 9876",
                    email: "luis.castro@email.com",
                    foto: null,
                    otrosCuerpos: "Cuerpo de Bomberos de Melipilla",
                    companiaOpcional: "Segunda Compa√±√≠a",
                    desde: "1985-01-10",
                    hasta: "1989-06-30",
                    fechaRegistro: new Date().toISOString()
                }
            ];

            bomberos.push(...ejemplos);
            
            // Generar ejemplos de sanciones y cargos
            cargarEjemplosSanciones();
            cargarEjemplosCargos();
        }

        // ACTUALIZADA: Cargar ejemplos de sanciones con nuevos campos
        function cargarEjemplosSanciones() {
            const hoy = new Date().toISOString().split('T')[0];
            
            const ejemplosSanciones = [
                // Sanciones para Carlos Eduardo Morales Silva (ID 1)
                {
                    id: sancionIdCounter++,
                    bomberoId: 1,
                    tipo: '‚è∏Ô∏è Suspensi√≥n',
                    companiaAutoridad: 'Primera Compa√±√≠a',
                    autoridadSancionatoria: 'Consejo de Disciplina de C√≠a',
                    fechaDesde: '2023-03-15',
                    fechaHasta: '2023-03-22',
                    diasSancion: 7,
                    oficioNumero: 'OF-2023-045',
                    fechaOficio: '2023-03-10',
                    motivo: 'Inasistencia reiterada a servicios ordinarios sin justificaci√≥n durante el mes de febrero 2023.',
                    fechaRegistro: new Date('2023-03-10').toISOString()
                },
                {
                    id: sancionIdCounter++,
                    bomberoId: 1,
                    tipo: 'üìù Renuncia',
                    companiaAutoridad: '',
                    autoridadSancionatoria: 'Consejo Superior de Disciplina',
                    fechaDesde: '2024-06-01',
                    fechaHasta: null,
                    diasSancion: null,
                    oficioNumero: 'CS-2024-128',
                    fechaOficio: hoy,
                    motivo: 'Renuncia voluntaria presentada por motivos personales y cambio de residencia a otra regi√≥n.',
                    fechaRegistro: new Date().toISOString()
                },
                
                // Sanciones para Mar√≠a Teresa Gonz√°lez Rodr√≠guez (ID 2)
                {
                    id: sancionIdCounter++,
                    bomberoId: 2,
                    tipo: '‚è∏Ô∏è Suspensi√≥n',
                    companiaAutoridad: 'Segunda Compa√±√≠a',
                    autoridadSancionatoria: 'Consejo de Disciplina de C√≠a',
                    fechaDesde: '2010-05-20',
                    fechaHasta: '2010-05-27',
                    diasSancion: 7,
                    oficioNumero: 'OF-2010-089',
                    fechaOficio: '2010-05-15',
                    motivo: 'Retraso en entrega de informes trimestrales de tesorer√≠a por tercera vez consecutiva.',
                    fechaRegistro: new Date('2010-05-15').toISOString()
                },
                {
                    id: sancionIdCounter++,
                    bomberoId: 2,
                    tipo: '‚è∏Ô∏è Suspensi√≥n',
                    companiaAutoridad: 'Segunda Compa√±√≠a',
                    autoridadSancionatoria: 'Consejo de Disciplina de C√≠a',
                    fechaDesde: '2022-08-10',
                    fechaHasta: '2022-08-24',
                    diasSancion: 14,
                    oficioNumero: 'OF-2022-233',
                    fechaOficio: '2022-08-05',
                    motivo: 'Incumplimiento de protocolo de seguridad durante emergencia vehicular en Av. Providencia.',
                    fechaRegistro: new Date('2022-08-05').toISOString()
                },
                
                // Sanciones para Roberto Antonio Fern√°ndez L√≥pez (ID 3)
                {
                    id: sancionIdCounter++,
                    bomberoId: 3,
                    tipo: '‚è∏Ô∏è Suspensi√≥n',
                    companiaAutoridad: 'Tercera Compa√±√≠a',
                    autoridadSancionatoria: 'Consejo de Disciplina de C√≠a',
                    fechaDesde: '2005-11-10',
                    fechaHasta: '2005-11-24',
                    diasSancion: 14,
                    oficioNumero: 'OF-2005-201',
                    fechaOficio: '2005-11-05',
                    motivo: 'Negligencia en mantenimiento de equipos resultando en falla durante emergencia nocturna.',
                    fechaRegistro: new Date('2005-11-05').toISOString()
                },
                {
                    id: sancionIdCounter++,
                    bomberoId: 3,
                    tipo: '‚ÜóÔ∏è Separaci√≥n',
                    companiaAutoridad: '',
                    autoridadSancionatoria: 'Consejo Superior de Disciplina',
                    fechaDesde: '2020-11-30',
                    fechaHasta: '2021-11-30',
                    diasSancion: 365,
                    oficioNumero: 'CD-2020-089',
                    fechaOficio: '2020-11-25',
                    motivo: 'Conducta impropia en acto oficial y representaci√≥n inadecuada de la instituci√≥n en evento p√∫blico.',
                    fechaRegistro: new Date('2020-11-25').toISOString()
                },
                
                // Sanciones para Manuel Alejandro Pe√±a Morales (ID 4) - M√°s sanciones por 52 a√±os
                {
                    id: sancionIdCounter++,
                    bomberoId: 4,
                    tipo: '‚è∏Ô∏è Suspensi√≥n',
                    companiaAutoridad: 'Primera Compa√±√≠a',
                    autoridadSancionatoria: 'Consejo de Disciplina de C√≠a',
                    fechaDesde: '1983-07-15',
                    fechaHasta: '1983-07-22',
                    diasSancion: 7,
                    oficioNumero: 'OF-1983-034',
                    fechaOficio: '1983-07-10',
                    motivo: 'Ausencia no justificada durante ejercicio de entrenamiento regional de rescate.',
                    fechaRegistro: new Date('1983-07-10').toISOString()
                },
                {
                    id: sancionIdCounter++,
                    bomberoId: 4,
                    tipo: '‚è∏Ô∏è Suspensi√≥n',
                    companiaAutoridad: 'Primera Compa√±√≠a',
                    autoridadSancionatoria: 'Consejo Superior de Disciplina',
                    fechaDesde: '2015-03-20',
                    fechaHasta: '2015-04-03',
                    diasSancion: 14,
                    oficioNumero: 'CS-2015-078',
                    fechaOficio: '2015-03-15',
                    motivo: 'Decisiones administrativas cuestionables que resultaron en p√©rdidas econ√≥micas menores.',
                    fechaRegistro: new Date('2015-03-15').toISOString()
                },
                
                // Sanciones para Francisca Alejandra Soto Vargas (ID 5)
                {
                    id: sancionIdCounter++,
                    bomberoId: 5,
                    tipo: '‚è∏Ô∏è Suspensi√≥n',
                    companiaAutoridad: 'Cuarta Compa√±√≠a',
                    autoridadSancionatoria: 'Consejo de Disciplina de C√≠a',
                    fechaDesde: '2024-02-10',
                    fechaHasta: '2024-02-17',
                    diasSancion: 7,
                    oficioNumero: 'OF-2024-034',
                    fechaOficio: hoy,
                    motivo: 'Inasistencia a capacitaci√≥n obligatoria de primeros auxilios sin justificaci√≥n m√©dica.',
                    fechaRegistro: new Date().toISOString()
                },
                
                // Sanciones para Luis Fernando Castro Mu√±oz (ID 6)
                {
                    id: sancionIdCounter++,
                    bomberoId: 6,
                    tipo: '‚è∏Ô∏è Suspensi√≥n',
                    companiaAutoridad: 'Quinta Compa√±√≠a',
                    autoridadSancionatoria: 'Consejo de Disciplina de C√≠a',
                    fechaDesde: '1998-09-15',
                    fechaHasta: '1998-09-29',
                    diasSancion: 14,
                    oficioNumero: 'OF-1998-178',
                    fechaOficio: '1998-09-10',
                    motivo: 'Da√±o a equipo de comunicaciones por negligencia en procedimientos de mantenimiento.',
                    fechaRegistro: new Date('1998-09-10').toISOString()
                },
                {
                    id: sancionIdCounter++,
                    bomberoId: 6,
                    tipo: '‚ÜóÔ∏è Separaci√≥n',
                    companiaAutoridad: '',
                    autoridadSancionatoria: 'Consejo Superior de Disciplina',
                    fechaDesde: '2022-06-15',
                    fechaHasta: '2023-06-15',
                    diasSancion: 365,
                    oficioNumero: 'CS-2022-091',
                    fechaOficio: '2022-06-10',
                    motivo: 'Falta grave: alteraci√≥n de documentos oficiales y falsificaci√≥n de horas de servicio reportadas.',
                    fechaRegistro: new Date('2022-06-10').toISOString()
                }
            ];

            sanciones.push(...ejemplosSanciones);
        }

        // Cargar ejemplos de cargos
        function cargarEjemplosCargos() {
            const ejemplosCargos = [
                // Cargos para Carlos Eduardo Morales Silva (ID 1) - 5 a√±os de servicio
                {
                    id: cargoIdCounter++,
                    bomberoId: 1,
                    a√±oCargo: 2020,
                    tipoCargo: 'Teniente Cuarto',
                    fechaInicioCargo: '2020-01-01',
                    fechaFinCargo: '2021-12-31',
                    premioA√±oServicio: 'Medalla 5 A√±os de Servicio',
                    observacionesCargo: 'Primer cargo de mando. Per√≠odo de 2 a√±os con desempe√±o satisfactorio.',
                    fechaRegistro: new Date('2020-01-15').toISOString()
                },
                {
                    id: cargoIdCounter++,
                    bomberoId: 1,
                    a√±oCargo: 2022,
                    tipoCargo: 'Teniente Tercero',
                    fechaInicioCargo: '2022-01-01',
                    fechaFinCargo: '2023-12-31',
                    premioA√±oServicio: null,
                    observacionesCargo: 'Tambi√©n ejerci√≥ como Instructor de nuevos voluntarios. Per√≠odo interrumpido por sanci√≥n.',
                    fechaRegistro: new Date('2022-01-10').toISOString()
                },

                // Cargos para Mar√≠a Teresa Gonz√°lez Rodr√≠guez (ID 2) - 22 a√±os de servicio
                {
                    id: cargoIdCounter++,
                    bomberoId: 2,
                    a√±oCargo: 2004,
                    tipoCargo: 'Secretario',
                    fechaInicioCargo: '2004-01-01',
                    fechaFinCargo: '2006-12-31',
                    premioA√±oServicio: 'Medalla 5 A√±os de Servicio',
                    observacionesCargo: 'Moderniz√≥ el sistema de archivo. Per√≠odo completo de 3 a√±os como Secretario.',
                    fechaRegistro: new Date('2004-01-15').toISOString()
                },
                {
                    id: cargoIdCounter++,
                    bomberoId: 2,
                    a√±oCargo: 2014,
                    tipoCargo: 'Tesorero',
                    fechaInicioCargo: '2014-01-01',
                    fechaFinCargo: '2016-12-31',
                    premioA√±oServicio: 'Medalla 15 A√±os de Servicio',
                    observacionesCargo: 'Gestion√≥ exitosamente presupuesto para renovaci√≥n completa de equipos.',
                    fechaRegistro: new Date('2014-01-12').toISOString()
                },
                {
                    id: cargoIdCounter++,
                    bomberoId: 2,
                    a√±oCargo: 2022,
                    tipoCargo: 'Teniente Primero',
                    fechaInicioCargo: '2022-01-01',
                    fechaFinCargo: null,
                    premioA√±oServicio: 'Medalla 20 A√±os de Servicio',
                    observacionesCargo: 'En ejercicio. Responsable de operaciones nocturnas y entrenamientos.',
                    fechaRegistro: new Date('2022-01-10').toISOString()
                },

                // Cargos para Roberto Antonio Fern√°ndez L√≥pez (ID 3) - 30 a√±os de servicio
                {
                    id: cargoIdCounter++,
                    bomberoId: 3,
                    a√±oCargo: 1996,
                    tipoCargo: 'Tesorero',
                    fechaInicioCargo: '1996-01-01',
                    fechaFinCargo: '1998-12-31',
                    premioA√±oServicio: null,
                    observacionesCargo: 'Implement√≥ primer sistema computarizado de contabilidad durante 3 a√±os.',
                    fechaRegistro: new Date('1996-01-12').toISOString()
                },
                {
                    id: cargoIdCounter++,
                    bomberoId: 3,
                    a√±oCargo: 2014,
                    tipoCargo: 'Capit√°n',
                    fechaInicioCargo: '2014-01-01',
                    fechaFinCargo: '2015-12-31',
                    premioA√±oServicio: 'Medalla 15 A√±os de Servicio',
                    observacionesCargo: 'Per√≠odo de 2 a√±os como Capit√°n dirigiendo construcci√≥n de nueva sede.',
                    fechaRegistro: new Date('2014-01-05').toISOString()
                },
                {
                    id: cargoIdCounter++,
                    bomberoId: 3,
                    a√±oCargo: 2019,
                    tipoCargo: 'Capit√°n',
                    fechaInicioCargo: '2019-01-01',
                    fechaFinCargo: null,
                    premioA√±oServicio: 'Medalla 25 A√±os de Servicio',
                    observacionesCargo: 'En ejercicio. Segundo per√≠odo como Capit√°n, mentoriza nuevos oficiales.',
                    fechaRegistro: new Date('2019-01-05').toISOString()
                },

                // Cargos para Manuel Alejandro Pe√±a Morales (ID 4) - 52 a√±os de servicio (Insigne)
                {
                    id: cargoIdCounter++,
                    bomberoId: 4,
                    a√±oCargo: 1977,
                    tipoCargo: 'Teniente Cuarto',
                    fechaInicioCargo: '1977-01-01',
                    fechaFinCargo: '1978-12-31',
                    premioA√±oServicio: 'Medalla 5 A√±os de Servicio',
                    observacionesCargo: 'Primer cargo administrativo. Per√≠odo de 2 a√±os en √©poca de grandes incendios.',
                    fechaRegistro: new Date('1977-01-20').toISOString()
                },
                {
                    id: cargoIdCounter++,
                    bomberoId: 4,
                    a√±oCargo: 1992,
                    tipoCargo: 'Capit√°n',
                    fechaInicioCargo: '1992-01-01',
                    fechaFinCargo: '1993-12-31',
                    premioA√±oServicio: 'Medalla 20 A√±os de Servicio',
                    observacionesCargo: 'Primer per√≠odo como Capit√°n. Moderniz√≥ equipos durante 2 a√±os.',
                    fechaRegistro: new Date('1992-01-08').toISOString()
                },
                {
                    id: cargoIdCounter++,
                    bomberoId: 4,
                    a√±oCargo: 2002,
                    tipoCargo: 'Director',
                    fechaInicioCargo: '2002-01-01',
                    fechaFinCargo: '2006-12-31',
                    premioA√±oServicio: 'Medalla 30 A√±os de Servicio',
                    observacionesCargo: 'Primer per√≠odo como Director durante 5 a√±os. Expansi√≥n regional.',
                    fechaRegistro: new Date('2002-01-05').toISOString()
                },
                {
                    id: cargoIdCounter++,
                    bomberoId: 4,
                    a√±oCargo: 2022,
                    tipoCargo: 'Intendente',
                    fechaInicioCargo: '2022-01-01',
                    fechaFinCargo: null,
                    premioA√±oServicio: 'Medalla de Oro 50 A√±os de Servicio',
                    observacionesCargo: 'En ejercicio. Cargo honor√≠fico por trayectoria excepcional.',
                    fechaRegistro: new Date('2022-01-05').toISOString()
                },

                // Cargos para Francisca Alejandra Soto Vargas (ID 5) - 2 a√±os de servicio
                {
                    id: cargoIdCounter++,
                    bomberoId: 5,
                    a√±oCargo: 2023,
                    tipoCargo: 'Secretario',
                    fechaInicioCargo: '2023-06-01',
                    fechaFinCargo: null,
                    premioA√±oServicio: null,
                    observacionesCargo: 'En ejercicio. Implementando modernizaci√≥n digital. Pr√≥xima a recibir Medalla 5 A√±os.',
                    fechaRegistro: new Date('2023-06-05').toISOString()
                },

                // Cargos para Luis Fernando Castro Mu√±oz (ID 6) - 35 a√±os de servicio
                {
                    id: cargoIdCounter++,
                    bomberoId: 6,
                    a√±oCargo: 1991,
                    tipoCargo: 'Jefe de M√°quinas',
                    fechaInicioCargo: '1991-01-01',
                    fechaFinCargo: '1993-12-31',
                    premioA√±oServicio: null,
                    observacionesCargo: 'Especialista en mantenimiento. Per√≠odo de 3 a√±os supervisando equipos.',
                    fechaRegistro: new Date('1991-01-20').toISOString()
                },
                {
                    id: cargoIdCounter++,
                    bomberoId: 6,
                    a√±oCargo: 2014,
                    tipoCargo: 'Capit√°n',
                    fechaInicioCargo: '2014-01-01',
                    fechaFinCargo: '2015-12-31',
                    premioA√±oServicio: 'Medalla 25 A√±os de Servicio',
                    observacionesCargo: 'Per√≠odo de 2 a√±os como Capit√°n modernizando protocolos operacionales.',
                    fechaRegistro: new Date('2014-01-05').toISOString()
                },
                {
                    id: cargoIdCounter++,
                    bomberoId: 6,
                    a√±oCargo: 2019,
                    tipoCargo: 'Intendente',
                    fechaInicioCargo: '2019-01-01',
                    fechaFinCargo: null,
                    premioA√±oServicio: 'Medalla 30 A√±os de Servicio',
                    observacionesCargo: 'En ejercicio. Administra recursos y log√≠stica. Pr√≥ximo a Medalla 35 A√±os.',
                    fechaRegistro: new Date('2019-01-10').toISOString()
                }
            ];

            cargos.push(...ejemplosCargos);
        }

        // Funciones principales del sistema
        function limpiarFormulario() {
            document.getElementById('formBombero').reset();
            document.getElementById('previewContainer').style.display = 'none';
            mostrarMensaje('Formulario limpiado', 'success');
        }

        function toggleInfoCategorias() {
            const info = document.getElementById('infoCategorias');
            info.style.display = info.style.display === 'none' || info.style.display === '' ? 'block' : 'none';
        }

        function toggleDatosEjemplo() {
            const clavesEjemplo = ["618-A", "425-B", "123-C", "001-D", "789-E", "345-F"];
            const tieneEjemplos = bomberos.some(b => clavesEjemplo.includes(b.claveBombero));
            
            if (tieneEjemplos) {
                // Obtener IDs de bomberos de ejemplo para eliminar sus sanciones y cargos
                const idsEjemplo = bomberos
                    .filter(b => clavesEjemplo.includes(b.claveBombero))
                    .map(b => b.id);
                
                // Remover SOLO los ejemplos, mantener bomberos reales
                const bomberosReales = bomberos.filter(b => !clavesEjemplo.includes(b.claveBombero));
                bomberos = bomberosReales;
                
                // Remover sanciones y cargos de los bomberos de ejemplo
                sanciones = sanciones.filter(s => !idsEjemplo.includes(s.bomberoId));
                cargos = cargos.filter(c => !idsEjemplo.includes(c.bomberoId));
                
                mostrarMensaje('Ejemplos eliminados: se removieron 6 bomberos + 12 sanciones + 18 cargos de ejemplo. Datos reales conservados.', 'success');
            } else {
                // Agregar ejemplos a los bomberos existentes
                cargarDatosEjemplo();
                mostrarMensaje('Ejemplos cargados: 6 bomberos + 12 sanciones + 18 cargos con funcionalidades completas', 'success');
            }
            
            terminoBusqueda = '';
            const buscador = document.getElementById('buscadorBomberos');
            if (buscador) {
                buscador.value = '';
                buscador.style.borderColor = '#e0e0e0';
                buscador.style.backgroundColor = '#f8f9fa';
            }
            renderizarBomberos();
        }

        // ACTUALIZADA: Funci√≥n para limpiar formulario de sanciones
        function limpiarFormularioSancion() {
            document.getElementById('formSancion').reset();
            if (bomberoSancionActual) {
                document.getElementById('bomberoSancionId').value = bomberoSancionActual.id;
            }
            
            // Limpiar selecci√≥n visual de radio buttons
            document.querySelectorAll('.tipo-sancion label').forEach(label => {
                label.classList.remove('selected');
            });
            
            // Restablecer fecha autom√°tica y limpiar campos calculados
            establecerFechaAutomatica();
            document.getElementById('fechaHasta').classList.remove('campo-calculado');
        }

        function limpiarFormularioCargo() {
            document.getElementById('formCargo').reset();
            if (bomberoCargoActual) {
                document.getElementById('bomberoCargoId').value = bomberoCargoActual.id;
            }
        }

        // Manejar selecci√≥n visual de radio buttons
        document.addEventListener('change', function(e) {
            if (e.target.name === 'tipoSancion') {
                // Remover estilo seleccionado de todos los labels
                document.querySelectorAll('.tipo-sancion label').forEach(label => {
                    label.classList.remove('selected');
                });
                
                // Agregar estilo al label seleccionado
                e.target.closest('label').classList.add('selected');
            }
        });

        // Funciones de validaci√≥n
        function validarRUN(run) {
            run = run.replace(/\./g, '').replace(/-/g, '');
            if (run.length < 8 || run.length > 9) return false;
            
            let cuerpo = run.slice(0, -1);
            let dv = run.slice(-1).toUpperCase();
            
            let suma = 0;
            let multiplo = 2;
            
            for (let i = cuerpo.length - 1; i >= 0; i--) {
                suma += parseInt(cuerpo[i]) * multiplo;
                multiplo = multiplo < 7 ? multiplo + 1 : 2;
            }
            
            let resto = suma % 11;
            let dvCalculado = 11 - resto;
            
            if (dvCalculado === 11) dvCalculado = '0';
            if (dvCalculado === 10) dvCalculado = 'K';
            
            return dv === dvCalculado.toString();
        }

        function validarTelefono(telefono) {
            const regex = /^(\+56|56)?[2-9]\d{7,8}$/;
            return regex.test(telefono.replace(/\s/g, ''));
        }

        function validarEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }

        // Funciones de edici√≥n
        function editarBombero(id) {
            const bombero = bomberos.find(b => b.id === id);
            if (!bombero) return;

            editandoId = id;
            
            // Cargar datos en el formulario
            document.getElementById('idEditando').value = id;
            document.getElementById('claveBombero').value = bombero.claveBombero;
            document.getElementById('nombre').value = bombero.nombre;
            document.getElementById('fechaNacimiento').value = bombero.fechaNacimiento;
            document.getElementById('run').value = bombero.run;
            document.getElementById('profesion').value = bombero.profesion;
            document.getElementById('domicilio').value = bombero.domicilio;
            document.getElementById('nroRegistro').value = bombero.nroRegistro;
            document.getElementById('fechaIngreso').value = bombero.fechaIngreso;
            document.getElementById('compania').value = bombero.compania;
            document.getElementById('grupoSanguineo').value = bombero.grupoSanguineo;
            document.getElementById('telefono').value = bombero.telefono;
            document.getElementById('email').value = bombero.email || '';
            document.getElementById('otrosCuerpos').value = bombero.otrosCuerpos || '';
            document.getElementById('companiaOpcional').value = bombero.companiaOpcional || '';
            document.getElementById('desde').value = bombero.desde || '';
            document.getElementById('hasta').value = bombero.hasta || '';

            // Mostrar foto actual si existe
            if (bombero.foto) {
                document.getElementById('previewImage').src = bombero.foto;
                document.getElementById('previewContainer').style.display = 'block';
            }

            // Mostrar modo edici√≥n
            document.getElementById('modoEdicion').style.display = 'block';
            document.getElementById('nombreEditando').textContent = bombero.nombre;
            document.getElementById('btnSubmit').textContent = 'Actualizar Bombero';

            // Scroll al formulario
            document.getElementById('formBombero').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelarEdicion() {
            editandoId = null;
            document.getElementById('modoEdicion').style.display = 'none';
            document.getElementById('btnSubmit').textContent = 'Registrar Bombero';
            limpiarFormulario();
        }

        function eliminarBombero(id) {
            const bombero = bomberos.find(b => b.id === id);
            if (!bombero) return;
            
            if (confirm(`¬øEst√° seguro de eliminar el registro de ${bombero.nombre}?`)) {
                bomberos = bomberos.filter(b => b.id !== id);
                
                // Si est√°bamos editando este bombero, cancelar la edici√≥n
                if (editandoId === id) {
                    cancelarEdicion();
                }
                
                renderizarBomberos();
                mostrarMensaje('Bombero eliminado correctamente', 'success');
            }
        }

        // ACTUALIZADA: Funci√≥n verSanciones con fecha autom√°tica
        function verSanciones(id) {
            const bombero = bomberos.find(b => b.id === id);
            if (!bombero) return;

            bomberoSancionActual = bombero;

            // Ocultar todas las p√°ginas y mostrar p√°gina de sanciones
            document.getElementById('containerPrincipal').style.display = 'none';
            document.getElementById('cargosContainer').style.display = 'none';
            document.getElementById('sancionesContainer').style.display = 'block';

            // Scroll hacia arriba
            window.scrollTo(0, 0);

            // Cargar informaci√≥n del bombero
            document.getElementById('sancionNombre').textContent = bombero.nombre;
            document.getElementById('sancionClave').textContent = bombero.claveBombero;
            document.getElementById('sancionRun').textContent = bombero.run;
            document.getElementById('sancionCompania').textContent = bombero.compania;
            document.getElementById('bomberoSancionId').value = bombero.id;

            // NUEVO: Establecer fecha autom√°tica al cargar
            establecerFechaAutomatica();

            // Cargar lista de sanciones
            renderizarSanciones();
        }

        function verCargos(id) {
            const bombero = bomberos.find(b => b.id === id);
            if (!bombero) return;

            bomberoCargoActual = bombero;

            // Ocultar todas las p√°ginas y mostrar p√°gina de cargos
            document.getElementById('containerPrincipal').style.display = 'none';
            document.getElementById('sancionesContainer').style.display = 'none';
            document.getElementById('cargosContainer').style.display = 'block';

            // Scroll hacia arriba
            window.scrollTo(0, 0);

            // Cargar informaci√≥n del bombero
            document.getElementById('cargoNombre').textContent = bombero.nombre;
            document.getElementById('cargoClave').textContent = bombero.claveBombero;
            document.getElementById('cargoRun').textContent = bombero.run;
            document.getElementById('cargoCompania').textContent = bombero.compania;
            document.getElementById('bomberoCargoId').value = bombero.id;

            // Cargar lista de cargos
            renderizarCargos();
        }

        // ACTUALIZADA: Renderizar lista de sanciones con nuevos campos
        function renderizarSanciones() {
            const lista = document.getElementById('listaSanciones');
            const total = document.getElementById('totalSanciones');
            
            if (!bomberoSancionActual) return;

            // Filtrar sanciones del bombero actual
            const sancionesBombero = sanciones.filter(s => s.bomberoId === bomberoSancionActual.id);
            total.textContent = sancionesBombero.length;
            
            if (sancionesBombero.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: rgba(255, 255, 255, 0.6); padding: 20px;">No hay sanciones registradas para este bombero</p>';
                return;
            }
            
            // Ordenar por fecha m√°s reciente
            const sancionesOrdenadas = [...sancionesBombero].sort((a, b) => new Date(b.fechaDesde) - new Date(a.fechaDesde));
            
            lista.innerHTML = sancionesOrdenadas.map(sancion => `
                <div class="sancion-card">
                    <div class="sancion-header">
                        <div class="sancion-tipo">${sancion.tipo}</div>
                        <div class="sancion-fecha">Registrada: ${new Date(sancion.fechaRegistro).toLocaleDateString()}</div>
                    </div>
                    <div class="sancion-info">
                        ${sancion.companiaAutoridad && sancion.companiaAutoridad.trim() ? `<div><strong>Compa√±√≠a:</strong> <span>${sancion.companiaAutoridad}</span></div>` : '<div><strong>Compa√±√≠a:</strong> <span style="color: rgba(255, 255, 255, 0.4); font-style: italic;">No especificado</span></div>'}
                        ${sancion.autoridadSancionatoria && sancion.autoridadSancionatoria.trim() ? `<div><strong>Autoridad Sancionatoria:</strong> <span>${sancion.autoridadSancionatoria}</span></div>` : '<div><strong>Autoridad Sancionatoria:</strong> <span style="color: rgba(255, 255, 255, 0.4); font-style: italic;">No especificado</span></div>'}
                        <div><strong>Desde:</strong> <span>${new Date(sancion.fechaDesde).toLocaleDateString()}</span></div>
                        ${sancion.fechaHasta ? `<div><strong>Hasta:</strong> <span>${new Date(sancion.fechaHasta).toLocaleDateString()}</span></div>` : '<div><strong>Hasta:</strong> <span style="color: rgba(255, 255, 255, 0.4); font-style: italic;">No especificado</span></div>'}
                        ${sancion.diasSancion ? `<div><strong>D√≠as de Sanci√≥n:</strong> <span style="color: #4caf50; font-weight: 500;">${sancion.diasSancion} d√≠as</span></div>` : '<div><strong>D√≠as de Sanci√≥n:</strong> <span style="color: rgba(255, 255, 255, 0.4); font-style: italic;">No especificado</span></div>'}
                        <div><strong>ID Oficio:</strong> <span>${sancion.oficioNumero}</span></div>
                        <div><strong>Fecha Registro:</strong> <span style="color: #ffa000; font-weight: 500;">${new Date(sancion.fechaOficio).toLocaleDateString()}</span></div>
                        <div style="grid-column: 1 / -1;"><strong>Motivo:</strong> <span>${sancion.motivo}</span></div>
                    </div>
                </div>
            `).join('');
        }

        // Renderizar lista de cargos
        function renderizarCargos() {
            const lista = document.getElementById('listaCargos');
            const total = document.getElementById('totalCargos');
            
            if (!bomberoCargoActual) return;

            // Filtrar cargos del bombero actual
            const cargosBombero = cargos.filter(c => c.bomberoId === bomberoCargoActual.id);
            total.textContent = cargosBombero.length;
            
            if (cargosBombero.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: rgba(255, 255, 255, 0.6); padding: 20px;">No hay cargos registrados para este bombero</p>';
                return;
            }
            
            // Ordenar por fecha m√°s reciente, luego por a√±o m√°s reciente
            const cargosOrdenados = [...cargosBombero].sort((a, b) => {
                // Primero ordenar por fecha de inicio si ambos la tienen
                if (a.fechaInicioCargo && b.fechaInicioCargo) {
                    return new Date(b.fechaInicioCargo) - new Date(a.fechaInicioCargo);
                }
                // Si solo uno tiene fecha, ese va primero
                if (a.fechaInicioCargo && !b.fechaInicioCargo) return -1;
                if (!a.fechaInicioCargo && b.fechaInicioCargo) return 1;
                
                // Si ninguno tiene fecha, ordenar por a√±o
                if (a.a√±oCargo && b.a√±oCargo) {
                    return b.a√±oCargo - a.a√±oCargo;
                }
                // Si solo uno tiene a√±o, ese va primero
                if (a.a√±oCargo && !b.a√±oCargo) return -1;
                if (!a.a√±oCargo && b.a√±oCargo) return 1;
                
                // Si ninguno tiene fecha ni a√±o, ordenar por fecha de registro
                return new Date(b.fechaRegistro) - new Date(a.fechaRegistro);
            });
            
            lista.innerHTML = cargosOrdenados.map(cargo => `
                <div class="cargo-card">
                    <div class="cargo-header">
                        <div class="cargo-tipo">
                            ${cargo.tipoCargo ? cargo.tipoCargo : 'Registro de Servicio'}
                            ${cargo.a√±oCargo ? ` (${cargo.a√±oCargo})` : ''}
                        </div>
                        <div class="cargo-fecha">
                            <div>Registrado: ${new Date(cargo.fechaRegistro).toLocaleDateString()}</div>
                        </div>
                    </div>
                    <div class="cargo-info">
                        ${cargo.a√±oCargo ? `<div><strong>A√±o:</strong> <span>${cargo.a√±oCargo}</span></div>` : ''}
                        ${cargo.tipoCargo ? `<div><strong>Cargo:</strong> <span>${cargo.tipoCargo}</span></div>` : ''}
                        ${cargo.fechaInicioCargo ? `<div><strong>Desde:</strong> <span>${new Date(cargo.fechaInicioCargo).toLocaleDateString()}</span></div>` : ''}
                        ${cargo.fechaFinCargo ? `<div><strong>Hasta:</strong> <span>${new Date(cargo.fechaFinCargo).toLocaleDateString()}</span></div>` : cargo.fechaInicioCargo ? `<div><strong>Estado:</strong> <span style="color: #4caf50; font-weight: bold;">En ejercicio</span></div>` : ''}
                        ${cargo.premioA√±oServicio ? `<div><strong>Premio A√±o Servicio:</strong> <span>${cargo.premioA√±oServicio}</span></div>` : ''}
                        ${cargo.observacionesCargo ? `<div style="grid-column: 1 / -1;"><strong>Observaciones / Otros Cargos:</strong> <span>${cargo.observacionesCargo}</span></div>` : `<div style="grid-column: 1 / -1;"><strong>Observaciones / Otros Cargos:</strong> <span style="color: rgba(255, 255, 255, 0.4); font-style: italic;">Sin observaciones</span></div>`}
                        ${!cargo.a√±oCargo && !cargo.tipoCargo && !cargo.fechaInicioCargo ? '<div style="grid-column: 1 / -1; color: rgba(255, 255, 255, 0.6); font-style: italic;">Registro de servicio sin campos principales especificados</div>' : ''}
                    </div>
                </div>
            `).join('');
        }

        // ACTUALIZADA: Funci√≥n para exportar sanciones a Excel con nuevos campos
        function exportarSancionesExcel() {
            if (!bomberoSancionActual) {
                mostrarMensaje('Error: No hay un bombero seleccionado', 'error');
                return;
            }

            const sancionesBombero = sanciones.filter(s => s.bomberoId === bomberoSancionActual.id);
            
            if (sancionesBombero.length === 0) {
                mostrarMensaje('No hay sanciones registradas para exportar', 'error');
                return;
            }

            // Verificar si XLSX est√° disponible
            if (typeof XLSX === 'undefined') {
                mostrarMensaje('Error: Librer√≠a Excel no est√° cargada', 'error');
                return;
            }

            try {
                const datosExcel = sancionesBombero.map((sancion, index) => ({
                    'N¬∞': index + 1,
                    'Bombero': bomberoSancionActual.nombre,
                    'Clave': bomberoSancionActual.claveBombero,
                    'RUN': bomberoSancionActual.run,
                    'Compa√±√≠a': bomberoSancionActual.compania,
                    'Tipo de Sanci√≥n': sancion.tipo,
                    'Compa√±√≠a Responsable': sancion.companiaAutoridad || 'No especificado',
                    'Autoridad Sancionatoria': sancion.autoridadSancionatoria || 'No especificado',
                    'Fecha Inicio': sancion.fechaDesde ? new Date(sancion.fechaDesde).toLocaleDateString() : '',
                    'Fecha T√©rmino': sancion.fechaHasta ? new Date(sancion.fechaHasta).toLocaleDateString() : 'No especificado',
                    'D√≠as de Sanci√≥n': sancion.diasSancion || 'No especificado',
                    'ID Oficio': sancion.oficioNumero,
                    'Fecha Registro': sancion.fechaOficio ? new Date(sancion.fechaOficio).toLocaleDateString() : '',
                    'Motivo': sancion.motivo
                }));

                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(datosExcel);
                XLSX.utils.book_append_sheet(wb, ws, 'Sanciones');
                
                const nombreArchivo = `Sanciones_${bomberoSancionActual.claveBombero}_${new Date().toLocaleDateString().replace(/\//g, '-')}.xlsx`;
                XLSX.writeFile(wb, nombreArchivo);
                
                mostrarMensaje('Excel de sanciones descargado exitosamente!', 'success');

            } catch (error) {
                console.error('Error Excel:', error);
                mostrarMensaje('Error al generar Excel: ' + error.message, 'error');
            }
        }

        // Funci√≥n para exportar cargos a Excel  
        function exportarCargosExcel() {
            if (!bomberoCargoActual) {
                mostrarMensaje('Error: No hay un bombero seleccionado', 'error');
                return;
            }

            const cargosBombero = cargos.filter(c => c.bomberoId === bomberoCargoActual.id);
            
            if (cargosBombero.length === 0) {
                mostrarMensaje('No hay cargos registrados para exportar', 'error');
                return;
            }

            // Verificar si XLSX est√° disponible
            if (typeof XLSX === 'undefined') {
                mostrarMensaje('Error: Librer√≠a Excel no est√° cargada', 'error');
                return;
            }

            try {
                const datosExcel = cargosBombero.map((cargo, index) => ({
                    'N¬∞': index + 1,
                    'Bombero': bomberoCargoActual.nombre,
                    'Clave': bomberoCargoActual.claveBombero,
                    'RUN': bomberoCargoActual.run,
                    'Compa√±√≠a': bomberoCargoActual.compania,
                    'A√±o': cargo.a√±oCargo || 'No especificado',
                    'Cargo': cargo.tipoCargo || 'No especificado',
                    'Desde': cargo.fechaInicioCargo ? new Date(cargo.fechaInicioCargo).toLocaleDateString() : 'No especificado',
                    'Hasta': cargo.fechaFinCargo ? new Date(cargo.fechaFinCargo).toLocaleDateString() : 'En ejercicio',
                    'Premio A√±o Servicio': cargo.premioA√±oServicio || 'No especificado',
                    'Observaciones': cargo.observacionesCargo || 'Sin observaciones'
                }));

                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(datosExcel);
                XLSX.utils.book_append_sheet(wb, ws, 'Cargos');
                
                const nombreArchivo = `Cargos_${bomberoCargoActual.claveBombero}_${new Date().toLocaleDateString().replace(/\//g, '-')}.xlsx`;
                XLSX.writeFile(wb, nombreArchivo);
                
                mostrarMensaje('Excel de cargos descargado exitosamente!', 'success');

            } catch (error) {
                console.error('Error Excel:', error);
                mostrarMensaje('Error al generar Excel: ' + error.message, 'error');
            }
        }

        function volverAListaBomberos() {
            document.getElementById('sancionesContainer').style.display = 'none';
            document.getElementById('cargosContainer').style.display = 'none';
            document.getElementById('containerPrincipal').style.display = 'block';
        }

        function volverAListaBomberosDesdeCargos() {
            volverAListaBomberos();
        }

        // Inicializar sistema
        document.addEventListener('DOMContentLoaded', function() {
            renderizarBomberos();
            
            // Inicializar buscador
            const buscador = document.getElementById('buscadorBomberos');
            if (buscador) {
                buscador.addEventListener('input', function(e) {
                    terminoBusqueda = e.target.value.toLowerCase();
                    renderizarBomberos();
                    
                    // Cambiar estilo del input seg√∫n si hay b√∫squeda
                    if (terminoBusqueda) {
                        e.target.style.borderColor = '#1976d2';
                        e.target.style.backgroundColor = '#f3f8ff';
                    } else {
                        e.target.style.borderColor = '#e0e0e0';
                        e.target.style.backgroundColor = '#f8f9fa';
                    }
                });
            }

            // Vista previa de imagen
            document.getElementById('foto').addEventListener('change', function(e) {
                const file = e.target.files[0];
                const previewContainer = document.getElementById('previewContainer');
                const previewImage = document.getElementById('previewImage');
                
                if (file) {
                    if (file.size > 5 * 1024 * 1024) { // 5MB m√°ximo
                        mostrarMensaje('La imagen no debe superar los 5MB', 'error');
                        e.target.value = '';
                        previewContainer.style.display = 'none';
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImage.src = e.target.result;
                        previewContainer.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    previewContainer.style.display = 'none';
                }
            });

            // Formatear RUN mientras se escribe
            document.getElementById('run').addEventListener('input', function(e) {
                let valor = e.target.value.replace(/\D/g, '');
                if (valor.length > 1) {
                    valor = valor.replace(/(\d{1,2})(\d{3})(\d{3})(\d{1})/, '$1.$2.$3-$4');
                }
                e.target.value = valor;
            });

            // Manejar env√≠o del formulario de bomberos
            document.getElementById('formBombero').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const datos = Object.fromEntries(formData);
                
                // Validaciones b√°sicas
                let errores = [];
                
                if (!datos.claveBombero.trim()) errores.push('Clave del bombero es obligatoria');
                if (!datos.nombre.trim()) errores.push('Nombre es obligatorio');
                if (!datos.run.trim()) errores.push('RUN es obligatorio');
                else if (!validarRUN(datos.run)) errores.push('RUN inv√°lido');
                if (!datos.profesion.trim()) errores.push('Profesi√≥n es obligatoria');
                if (!datos.domicilio.trim()) errores.push('Domicilio es obligatorio');
                if (!datos.nroRegistro.trim()) errores.push('N√∫mero de registro es obligatorio');
                if (!datos.fechaIngreso) errores.push('Fecha de ingreso es obligatoria');
                if (!datos.compania.trim()) errores.push('Compa√±√≠a es obligatoria');
                if (!datos.grupoSanguineo) errores.push('Grupo sangu√≠neo es obligatorio');
                if (!datos.telefono.trim()) errores.push('Tel√©fono es obligatorio');
                else if (!validarTelefono(datos.telefono)) errores.push('Tel√©fono inv√°lido');
                if (datos.email && datos.email.trim() && !validarEmail(datos.email)) errores.push('Email inv√°lido');

                // Validar duplicados solo si no estamos editando
                if (!editandoId) {
                    const bomberoExistenteClave = bomberos.find(b => b.claveBombero === datos.claveBombero);
                    if (bomberoExistenteClave) errores.push('Esta clave ya est√° registrada');
                    
                    const bomberoExistenteRUN = bomberos.find(b => b.run === datos.run);
                    if (bomberoExistenteRUN) errores.push('Este RUN ya est√° registrado');
                    
                    const bomberoExistenteRegistro = bomberos.find(b => b.nroRegistro === datos.nroRegistro);
                    if (bomberoExistenteRegistro) errores.push('Este n√∫mero de registro ya existe');
                    
                    if (datos.email && datos.email.trim()) {
                        const bomberoExistenteEmail = bomberos.find(b => b.email && b.email.toLowerCase() === datos.email.toLowerCase());
                        if (bomberoExistenteEmail) errores.push('Este email ya est√° registrado');
                    }
                }

                if (errores.length > 0) {
                    mostrarMensaje('Errores: ' + errores.join(', '), 'error');
                    return;
                }
                
                const fotoInput = document.getElementById('foto');
                const file = fotoInput.files[0];
                
                function procesarDatos(fotoBase64 = null) {
                    const bomberoData = {
                        ...datos,
                        foto: fotoBase64,
                        fechaRegistro: new Date().toISOString()
                    };
                    
                    if (editandoId) {
                        // Actualizar bombero existente
                        const index = bomberos.findIndex(b => b.id === editandoId);
                        if (index !== -1) {
                            bomberoData.id = editandoId;
                            // Mantener la foto anterior si no se subi√≥ una nueva
                            if (!fotoBase64) {
                                bomberoData.foto = bomberos[index].foto;
                            }
                            bomberos[index] = bomberoData;
                            mostrarMensaje('Bombero actualizado exitosamente', 'success');
                        }
                        cancelarEdicion();
                    } else {
                        // Agregar nuevo bombero
                        bomberoData.id = idCounter++;
                        bomberos.push(bomberoData);
                        mostrarMensaje('Bombero registrado exitosamente', 'success');
                    }
                    
                    renderizarBomberos();
                    document.getElementById('formBombero').reset();
                    document.getElementById('previewContainer').style.display = 'none';
                }
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        procesarDatos(e.target.result);
                    };
                    reader.readAsDataURL(file);
                } else {
                    procesarDatos();
                }
            });

            // ACTUALIZADO: Manejar env√≠o del formulario de sanciones con nuevos campos
            document.getElementById('formSancion').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const datos = Object.fromEntries(formData);
                
                // Obtener tipo de sanci√≥n seleccionado (radio button)
                const tipoSancionElement = document.querySelector('input[name="tipoSancion"]:checked');
                let tipoSancion = '';
                
                if (tipoSancionElement) {
                    const tiposMap = {
                        'renuncia': 'üìù Renuncia',
                        'suspension': '‚è∏Ô∏è Suspensi√≥n', 
                        'separacion': '‚ÜóÔ∏è Separaci√≥n',
                        'expulsion': '‚ùå Expulsi√≥n'
                    };
                    tipoSancion = tiposMap[tipoSancionElement.value];
                }

                // Validaciones b√°sicas
                let errores = [];
                if (!tipoSancion) errores.push('Debe seleccionar un tipo de sanci√≥n');
                if (!datos.fechaDesde) errores.push('La fecha desde es obligatoria');
                if (!datos.oficioNumero.trim()) errores.push('El ID del oficio es obligatorio');
                if (!datos.motivo.trim()) errores.push('El motivo es obligatorio');
                else if (datos.motivo.length < 10) errores.push('El motivo debe tener al menos 10 caracteres');

                // Validar fechas
                if (datos.fechaDesde && datos.fechaHasta) {
                    if (new Date(datos.fechaDesde) > new Date(datos.fechaHasta)) {
                        errores.push('La fecha hasta debe ser posterior a la fecha desde');
                    }
                }

                // Validar d√≠as de sanci√≥n
                if (datos.diasSancion && datos.diasSancion < 1) {
                    errores.push('Los d√≠as de sanci√≥n deben ser mayor a 0');
                }

                if (errores.length > 0) {
                    mostrarMensaje('Errores: ' + errores.join(', '), 'error');
                    return;
                }
                
                const sancion = {
                    id: sancionIdCounter++,
                    bomberoId: parseInt(datos.bomberoSancionId),
                    tipo: tipoSancion,
                    companiaAutoridad: datos.companiaAutoridad,
                    autoridadSancionatoria: datos.autoridadSancionatoria, // NUEVO CAMPO
                    fechaDesde: datos.fechaDesde,
                    fechaHasta: datos.fechaHasta || null,
                    diasSancion: datos.diasSancion ? parseInt(datos.diasSancion) : null, // NUEVO CAMPO
                    oficioNumero: datos.oficioNumero,
                    fechaOficio: datos.fechaOficio, // FECHA AUTOM√ÅTICA
                    motivo: datos.motivo,
                    fechaRegistro: new Date().toISOString()
                };
                
                sanciones.push(sancion);
                renderizarSanciones();
                limpiarFormularioSancion();
                mostrarMensaje('Sanci√≥n registrada exitosamente', 'success');
            });

            // Manejar env√≠o del formulario de cargos
            document.getElementById('formCargo').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const datos = Object.fromEntries(formData);

                // Validar que al menos uno de los campos principales est√© completo
                const tieneA√±o = datos.a√±oCargo && datos.a√±oCargo.trim();
                const tieneCargo = datos.tipoCargo && datos.tipoCargo.trim();
                const tieneDesde = datos.fechaInicioCargo && datos.fechaInicioCargo.trim();

                let errores = [];
                if (!tieneA√±o && !tieneCargo && !tieneDesde) {
                    errores.push('Debe completar al menos uno de los siguientes campos: A√±o, Cargo o Desde');
                }

                // Validar a√±o si est√° presente
                if (datos.a√±oCargo && (datos.a√±oCargo < 1950 || datos.a√±oCargo > 2030)) {
                    errores.push('El a√±o debe estar entre 1950 y 2030');
                }

                // Validar fechas
                if (datos.fechaInicioCargo && datos.fechaFinCargo) {
                    if (new Date(datos.fechaInicioCargo) > new Date(datos.fechaFinCargo)) {
                        errores.push('La fecha de t√©rmino debe ser posterior a la fecha de inicio');
                    }
                }

                if (errores.length > 0) {
                    mostrarMensaje('Errores: ' + errores.join(', '), 'error');
                    return;
                }
                
                const cargo = {
                    id: cargoIdCounter++,
                    bomberoId: parseInt(datos.bomberoCargoId),
                    a√±oCargo: datos.a√±oCargo ? parseInt(datos.a√±oCargo) : null,
                    tipoCargo: datos.tipoCargo || null,
                    fechaInicioCargo: datos.fechaInicioCargo || null,
                    fechaFinCargo: datos.fechaFinCargo || null,
                    premioA√±oServicio: datos.premioA√±oServicio || null,
                    observacionesCargo: datos.observacionesCargo || null,
                    fechaRegistro: new Date().toISOString()
                };
                
                cargos.push(cargo);
                renderizarCargos();
                limpiarFormularioCargo();
                mostrarMensaje('Cargo registrado exitosamente', 'success');
            });
        });

        // Inicializar part√≠culas cuando cargue la p√°gina
        window.addEventListener('load', createParticles);

        // Console log con informaci√≥n de usuarios para desarrollo
        console.log('=== SISTEMA DE LOGIN ===');
        console.log('Usuarios disponibles:');
        Object.keys(users).forEach(username => {
            console.log(`üë§ ${username} | üîë ${users[username].password} | üé≠ ${users[username].role}`);
        });
        console.log('========================');
    </script>
</body>
</html>